<html dir="LTR" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><meta http-equiv="Content-Type" content="text/html; CHARSET=Windows-1252"><meta name="save" content="history"><title>Ktpass</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"><input type="hidden" id="hiddenScrollOffset"></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Ktpass</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p>Applies To: Windows Server 2008</p>
				<p>Configures the server principal name for the host or service in Active Directory Domain Services (AD DS) and generates a .keytab file containing the shared secret key of the service. The .keytab file is based on the Massachusetts Institute of Technology 
(MIT) implementation of the Kerberos authentication protocol. The Ktpass command-line tool allows UNIX-based services that support Kerberos authentication to use the interoperability features provided by the Kerberos Key Distribution Center (KDC) service in Windows Server 2008 R2.</p>
				<p>For examples of how this command can be used, see <a href="#BKMK_examples">Examples</a>.</p>
			<h2 class="heading">Syntax</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>ktpass
[/out &lt;FileName&gt;] 
[/princ &lt;PrincipalName&gt;] 
[/mapuser &lt;UserAccount&gt;] 
[/mapop {add|set}] [{-|+}desonly] [/in &lt;FileName&gt;]
[/pass {Password|*|{-|+}rndpass}]
[/minpass]
[/maxpass]
[/crypto {DES-CBC-CRC|DES-CBC-MD5|RC4-HMAC-NT|AES256-SHA1|AES128-SHA1|All}]
[/itercount]
[/ptype {KRB5_NT_PRINCIPAL|KRB5_NT_SRV_INST|KRB5_NT_SRV_HST}]
[/kvno &lt;KeyVersionNum&gt;]
[/answer {-|+}]
[/target]
[/rawsalt] [{-|+}dumpsalt] [{-|+}setupn] [{-|+}setpass &lt;Password&gt;]  [/?|/h|/help]</pre></td></tr></table></span></div>
				</content></div><h2 class="heading">Parameters</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Parameter
								</th>
								<th colspan="1">
									Description
								</th>
							</tr><tr>
							<td colspan="1">
								<p>/out &lt;FileName&gt;</p>
							</td>
							<td colspan="1">
								<p>Specifies the name of the Kerberos version 5 .keytab file to generate.</p>
								<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
									This is the .keytab file that you transfer to the UNIX computer and replace or merge with your existing .keytab file, /Etc/Krb5.keytab.<p>
								</td></tr></table><p></div>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/princ &lt;PrincipalName&gt;</p>
							</td>
							<td colspan="1">
								<p>Specifies the principal name in the form <i>user@REALM</i>.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/mapuser &lt;UserAccount&gt;</p>
							</td>
							<td colspan="1">
								<p>Maps the name of the Kerberos principal specified by the <b>princ</b> parameter to the specified local user name. By default, Kerberos principals are not mapped to local user names.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/mapop {add|set}</p>
							</td>
							<td colspan="1">
								<p>Specifies how the mapping attribute is set.</p>
								<ul><li class="unordered">
										
											<b>Add</b> adds the value of the specified local user name. This is the default.<br><br>
									</li><li class="unordered">
										
											<b>Set</b> sets the value for Data Encryption Standard (DES)-only encryption for the specified local user name.<br><br>
									</li></ul>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>{-|+}desonly </p>
							</td>
							<td colspan="1">
								<p>DES-only encryption is set by default.</p>
								<ul><li class="unordered">
										
											<b>+</b> Sets an account for DES-only encryption. <br><br>
									</li><li class="unordered">
										
											<b>-</b> Releases restriction on an account for DES-only encryption.<br><br>
									</li></ul>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/in &lt;FileName&gt;</p>
							</td>
							<td colspan="1">
								<p>Specifies the .keytab file from the UNIX host to read.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/pass {Password|*|{-|+}rndpass}</p>
							</td>
							<td colspan="1">
								<p>Specifies a password for the principal user name specified in the <b>princ</b> parameter. Use "*" to prompt for a password.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/minpass</p>
							</td>
							<td colspan="1">
								<p>Sets the minimum length of the random password to 15 characters.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/maxpass</p>
							</td>
							<td colspan="1">
								<p>Sets the maximum length of the random password to 256 characters.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/crypto {DES-CBC-CRC|DES-CBC-MD5|RC4-HMAC-NT|AES256-SHA1|AES128-SHA1|All}</p>
							</td>
							<td colspan="1">
								<p>Sets the encryption type to use.</p>
								<ul><li class="unordered">
										
											<b>DES-CBC-CRC</b> is the default and is used for compatibility.<br><br>
									</li><li class="unordered">
										
											<b>DES-CBC-MD5</b> adheres more closely to the MIT implementation and is used for compatibility.<br><br>
									</li><li class="unordered">
										
											<b>RC4-HMAC-NT</b> is the default and employs 128-bit encryption.<br><br>
									</li><li class="unordered">
										
											<b>AES256-SHA1</b> employs AES256-CTS-HMAC-SHA1-96 encryption.<br><br>
									</li><li class="unordered">
										
											<b>AES128-SHA1</b> employs AES128-CTS-HMAC-SHA1-96 encryption.<br><br>
									</li><li class="unordered">
										
											<b>All</b> states that all supported cryptographic types can be used.<br><br>
									</li></ul>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/itercount</p>
							</td>
							<td colspan="1">
								<p>Specifies the iteration count that is used for AES encryption. The default is that <b>itercount</b> is ignored for non-AES encryption and set at 4,096 for AES encryption.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/ptype {KRB5_NT_PRINCIPAL|KRB5_NT_SRV_INST|KRB5_NT_SRV_HST}</p>
							</td>
							<td colspan="1">
								<p>Specifies the principal type.</p>
								<ul><li class="unordered">
										
											<b>KRB5_NT_PRINCIPAL</b> is the general principal type (recommended).<br><br>
									</li><li class="unordered">
										
											<b>KRB5_NT_SRV_INST</b> is the user service instance.<br><br>
									</li><li class="unordered">
										
											<b>KRB5_NT_SRV_HST</b> is the host service instance.<br><br>
									</li></ul>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/kvno &lt;KeyVersionNum&gt;</p>
							</td>
							<td colspan="1">
								<p>Specifies the Key version number. The default value is 1.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/answer {-|+}</p>
							</td>
							<td colspan="1">
								<p>Sets the background answer mode:</p>
								<p>
									<b>-</b> Answers reset password prompts automatically with NO.</p>
								<p>
									<b>+</b> Answers reset password prompts automatically with YES.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/target</p>
							</td>
							<td colspan="1">
								<p>Sets which domain controller to use. The default is for the domain controller to be detected based on the principal name. If the domain controller name does not resolve, a dialog box will prompt for a valid domain controller.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/rawsalt </p>
							</td>
							<td colspan="1">
								<p>Forces Ktpass to use the rawsalt algorithm when generating the key. This parameter is not needed.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>{-|+}dumpsalt</p>
							</td>
							<td colspan="1">
								<p>Shows in the output the MIT salt algorithm being used to generate the key.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>{-|+}setupn</p>
							</td>
							<td colspan="1">
								<p>Sets the user principal name (UPN) in addition to the service principal name (SPN). The default is to set both in the .keytab file.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>{-|+}setpass &lt;Password&gt;</p>
							</td>
							<td colspan="1">
								<p>Sets the user's password when supplied. If rndpass is used, a random password is generated instead.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/?|/h|/help</p>
							</td>
							<td colspan="1">
								<p>Displays command-line help for Ktpass.</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">Remarks</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">Services running on UNIX systems can be configured with service instance accounts in AD DS. This allows full interoperability. MIT Kerberos clients and servers on UNIX systems can authenticate by using the Windows Server 2008 R2based Kerberos server, and clients connected to servers running Windows Server 2008 R2 can authenticate to Kerberos services that support the Generic Security Service application programming interface (GSS-API).</p>
					<p xmlns="">Unlike Kerberos principal names, account names in Windows Server 2008 and Windows Server 2008 R2 do not have multiple parts. For this reason, it is not possible to directly create an account from the name Sample/Unix1.example.com. Such a principal instance is created by using the SPN mappings.</p>
					<p xmlns="">To generate a UNIX host .keytab file, use the following steps to map the principal to the account and set the host principal password:</p>
					<ol class="ordered" xmlns=""><li>
							Use the Active Directory User and Computers snap-in to create a user account for the UNIX service. For example, create an account with the name SampleUnix1.<br><br>
						</li><li>
							Use Ktpass to set up an identity mapping for the user account by typing the following at a command line: <br><br>
							<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>ktpass /princ &lt;ServiceInstance@REALM&gt; /mapuser &lt;AccountName&gt; /pass &lt;Password&gt; /out &lt;Unixmachine.keytab&gt; </pre></td></tr></table></span></div>
							<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
								Replace <i>ServiceInstance@REALM</i>, <i>AccountName</i>, <i>Password</i>, and <i>Unixmachine.keytab</i> with actual values.<p>
								You cannot map multiple service instances to the same user account.<p>
							</td></tr></table><p></div>
						</li><li>
							Merge the .keytab file with the /Etc/Krb5.keytab file on the UNIX host as shown in the following example. <br><br>
						</li></ol>
				</content></div><a name="BKMK_examples"></a><a name="47087676-311e-41f1-8414-199740d01444#BKMK_examples"></a><h2 class="heading">Examples</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">The following example illustrates how to create a Kerberos .keytab file, Unixmachine.keytab, in the current directory for the user someone. (You will merge this file with the Krb5.keytab file on the UNIX host.) The Kerberos .keytab file will be created for AES256-CTS-HMAC-SHA1-96 encryption (as an example of the cryptographic support on the UNIX host) for the general principal type. A random password will be generated without minimum or maximum character length stipulated, and the "reset password prompt" will be (by default) automatically answered with a YES. Because the target domain controller is not specified, the tool detects the one matching the domain and reports the target used.</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>&lt;drive:\&gt; ktpass /out Unixmachine.keytab /mapuser someone@example.com /princ someone/techgroup.example.com@example.com 
/crypto AES256-SHA1 /pass rndpass /ptype KRB5_NT_PRINCIPAL</pre></td></tr></table></span></div>
				</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
						</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
							<h4 class="subHeading" xmlns="">Additional references</h4><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">
										<a href="338c0381-ad63-4a4c-bd2c-42c7a93821fe.htm">Command-Line Syntax Key</a>
									</p>
								</content></div>
						</sections></div>
				</sections></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><hr><p></div></div></body></html>