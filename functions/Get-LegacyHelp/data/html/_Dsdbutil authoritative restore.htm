<html dir="LTR" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><meta http-equiv="Content-Type" content="text/html; CHARSET=Windows-1252"><meta name="save" content="history"><title>authoritative restore</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"><input type="hidden" id="hiddenScrollOffset"></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">authoritative restore</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p>Applies To: Windows Server 2003 R2,Windows Server 2003 R2,Windows Server 2003,Windows Server 2003,Windows Server 2008,Windows Server 2008,Windows Server 2003 with SP1,Windows Server 2003 with SP1</p>
				<p>Restores domain controllers to a specific point in time, and marks objects in Active Directory as being authoritative with respect to their replication partners. </p>
				<p>This is a subcommand of Ntdsutil and Dsdbutil. Ntdsutil and Dsdbutil are command-line tools that are built into Windows Server 2008 and Windows Server 2008 R2. Ntdsutil is available if you have the Active Directory Domain Services (AD DS) or Active Directory Lightweight Directory Services (AD LDS) server role installed. Dsdbutil is available if you have the AD LDS server role installed. These tools are also available if you install the Active Directory Domain Services Tools that are part of the Remote Server Administration Tools (RSAT). For more information, see <a href="http://go.microsoft.com/fwlink/?LinkID=177813" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">How to Administer Microsoft Windows Client and Server Computers Locally and Remotely</linktext></a> (http://go.microsoft.com/fwlink/?LinkID=177813).</p>
				<p>To use either of these tools, you must run them from an elevated command prompt. To open an elevated command prompt, click <b>Start</b>, right-click <b>Command Prompt</b>, and then click <b>Run as administrator</b>.</p>
				<p>In forests that have a functional level of Windows Server 2003, Windows Server 2003 interim, or Windows Server 2008, this subcommand also restores back-links for links that were created after the functional level was raised. For example, the member attributes of groups to which a restored user object belongs are updated. The <b>authoritative restore</b> subcommand creates an LDAP Data Interchange Format (LDIF) file that can be used to restore back-links for links that were created before the functional level was raised.</p>
				<p>At the <b>authoritative restore:</b> prompt, type any of the parameters listed under “Syntax.”</p>
				<p>For examples of how to use this command, see <a href="#BKMK_examples">Examples</a>.</p>
			<h2 class="heading">Syntax</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>{create ldif file(s) from %s | list nc crs | restore object %s | restore object verinc %d |restore subtree %s | restore subtree %s verinc %d}</pre></td></tr></table></span></div>
				</content></div><h2 class="heading">Parameters</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Parameter
								</th>
								<th colspan="2">
									Description
								</th>
							</tr><tr>
							<td colspan="1">
								<p>create ldif file(s) from %s</p>
							</td>
							<td colspan="2">
								<p>This option creates an LDIF file of link updates from the Ntdsutil-generated text file that is named in <i>%s</i>. This file can be used to update back-links on objects in a domain other than the domain of the restored object. For example, this file can be used to restore group membership for a user where the group belongs to a different domain than the user.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>List NC CRs</p>
							</td>
							<td colspan="2">
								<p>Lists partitions and cross-references. You need the cross-reference of an application directory partition to restore it.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>%d</p>
							</td>
							<td colspan="2">
								<p>A numeric value that overrides the default value of 100,000. The version number of the object or database being authoritatively restored will be increased by this value times the number of days since backup.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>restore object %s</p>
							</td>
							<td colspan="2">
								<p>Marks object <i>%s</i> as being authoritative. This option also generates a text file that contains the distinguished name of the restored object and an LDIF file that can be used to restore back-links for objects that are being authoritatively restored (such as group memberships of users).</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>restore object %s verinc %d</p>
							</td>
							<td colspan="2">
								<p>Marks object <i>%s</i> <i> </i>as being authoritative and updates links as described in <b>restore object </b><i>%s</i>; also increments the version number by <i>%d</i> times the number of days since backup. Use this option only to authoritatively restore over a previous, incorrect authoritative restore, such as an authoritative restore from a backup that contains the problem that you want to restore.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>restore subtree %s</p>
							</td>
							<td colspan="2">
								<p>Marks subtree <i>%s</i> (and all children of the subtree) as being authoritative. This option also generates a text file that contains the distinguished names of the restored objects and an LDIF file that can be used to restore back-links for objects that are being authoritatively restored (such as group memberships of users).</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>restore subtree %s verinc %d</p>
							</td>
							<td colspan="2">
								<p>Marks subtree <i>%s</i> (and all children of the subtree) as being authoritative and updates links as described in <b>restore subtree </b><i>%s</i>; also increments the version number by <i>%d</i> times the number of days since backup. Use this option only to authoritatively restore over a previous, incorrect authoritative restore, such as an authoritative restore from a backup that contains the problem that you want to restore.</p>
							</td>
						</tr><tr>
							<td>
								<p>Toggle recycled objects flag</p>
								<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
									This parameter is available only if Active Directory Recycle Bin is enabled.<p>
								</td></tr></table><p></div>
							</td>
							<td>
								<p>Sets the flag to allow undeletion or authoritative restore of recycled objects. </p>
								<p>This is not recommended and can result in lost linked values after undeletion or authoritative restore. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>%s</p>
							</td>
							<td colspan="2">
								<p>An alphanumeric variable, either a distinguished name for a restored object or subtree, or a file name for a text file that is used to create an LDIF file.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>quit</p>
							</td>
							<td colspan="2">
								<p>Takes you back to the previous menu, or exits the utility.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>?</p>
							</td>
							<td colspan="2">
								<p>Displays Help at the command prompt.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Help</p>
							</td>
							<td colspan="1">
								<p>Displays Help at the command prompt.</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">Remarks</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<ul xmlns=""><li class="unordered">
							Before you can run the authoritative restore subcommand, you need to set NTDS or an AD LDS instance as the active instance for Ntdsutil. For example, if the AD LDS instance that you want to restore is named instance 1, type the following command at the <b>ntdsutil:</b> prompt before you run the authoritative restore subcommand, and then press ENTER:<br><br>
							<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>ac in instance 1</pre></td></tr></table></span></div>
						</li><li class="unordered">
							You need to stop the AD DS or AD LDS service before you can run the authoritative restore subcommand. To stop AD DS, click <b>Start</b>, click <b>Server Manager</b>. In the console tree, double-click <b>Configuration</b>, and then click <b>Services</b>. In the details pane, right-click <b>Active Directory Domain Services</b>, and then click <b>Stop</b>. <br><br>
						</li><li class="unordered">
							When you are restoring a domain controller by using backup and restore programs, such as Windows Server Backup or those from other providers, the default mode for the restore is nonauthoritative. This means that the restored server is brought up to date with its replicas through the normal replication mechanism. For example, if a domain controller is restored from a backup tape that is two weeks old, when you restart it, the normal replication mechanism brings it up to date with respect to its replication partners.<br><br>
						</li><li class="unordered">
							You might have to perform an authoritative restore if an administrator inadvertently deletes an organizational unit (OU) containing a large number of users. If you restore the server from tape, the normal replication process would not restore the inadvertently deleted OU. Authoritative restore allows you to mark the OU as authoritative and force the replication process to restore it to all the other domain controllers in the domain.<br><br>
						</li><li class="unordered">
							
								Ntdsutil does not correctly handle special characters, such as the apostrophe character ('), that you can enter at the <b>ntdsutil:</b> prompt at the command line. In some situations, there may be an alternative workaround. For more information, see <a href="http://go.microsoft.com/fwlink/?LinkId=157320" alt="" target="_blank"><maml:linktext xmlns:maml="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">local roles</maml:linktext></a> (http://go.microsoft.com/fwlink/?LinkId=157320).
							<br><br>
						</li></ul>
				</content></div><a name="BKMK_examples"></a><a name="b5416510-9aa5-44e4-8b4b-279dee264183#BKMK_examples"></a><h2 class="heading">Examples</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">To list the directory partitions on a domain controller and their cross-references, type the following command, and then press ENTER:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>authoritative restore: list nc crs</pre></td></tr></table></span></div>
				</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
						</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
							<h4 class="subHeading" xmlns="">Additional references</h4><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">
										<a href="338c0381-ad63-4a4c-bd2c-42c7a93821fe.htm">Command-Line Syntax Key</a>
									</p>
<p xmlns=""><a href="0c7f4cee-53cb-443c-b194-524c9360deac.htm">Dsdbutil</a></p><p xmlns=""><a href="199cebb9-967c-4307-a9d7-1c0bb50dc75b.htm">Ntdsutil</a></p><p xmlns=""><a href="f27dc4c0-0623-401b-b411-48acf995f595.htm">configurable settings</a></p><p xmlns=""><a href="baa9c5e1-0c26-4d57-8ca9-ff5b15c33d29.htm">DS behavior</a></p><p xmlns=""><a href="594c47bc-095d-465e-b7cb-3f0234350460.htm">files</a></p><p xmlns=""><a href="dc3722d8-b6de-4863-b456-1b17139caa42.htm">group membership evaluation</a></p><p xmlns=""><a href="c705e804-97d5-4a15-8d60-1ba09e5544e6.htm">ifm</a></p><p xmlns=""><a href="309950c8-5bfa-4b9e-b4a2-706ac63948ec.htm">LDAP policies</a></p><p xmlns=""><a href="aee69f2f-49bf-49cb-ac0b-eccc26423b1f.htm">local roles</a></p><p xmlns=""><a href="8ff66708-2ad0-4f52-982d-376a50a0e2dd.htm">metadata cleanup</a></p><p xmlns=""><a href="8ee336a2-b784-4743-8500-8d224a372110.htm">partition management</a></p><p xmlns=""><a href="f74c0470-3b2d-422c-bbbc-385cf39ec175.htm">roles</a></p><p xmlns=""><a href="1a4153d9-eb6e-4c50-8063-eb4ce961c32c.htm">security account management</a></p><p xmlns=""><a href="16b6f806-20b9-47bd-92c5-5cd96645c3bf.htm">semantic database analysis</a></p><p xmlns=""><a href="66fbd855-b3ee-434f-b890-c96858da8178.htm">set DSRM password</a></p><p xmlns=""><a href="a4b0e355-cbd0-4f48-9484-877fad1789ec.htm">snapshot</a></p></content></div>
						</sections></div>
				</sections></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><hr><p></div></div></body></html>