<html dir="LTR" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><meta http-equiv="Content-Type" content="text/html; CHARSET=Windows-1252"><meta name="save" content="history"><title>Adprep</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"><input type="hidden" id="hiddenScrollOffset"></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Adprep</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p>Applies To: Windows Server 2008,Windows Server 2003 with SP1,Windows Server 2003 R2,Windows Server 2003</p>
				<p>Extends the Active Directory® schema and updates permissions as necessary to prepare a forest and domain for a domain controller that runs the Windows Server® 2008 operating system.</p>
				<p>Adprep.exe is a command-line tool that is available on the Windows Server 2008 installation disc in the \sources\adprep folder, and it is available on the Windows Server 2008 R2 installation disk in the \support\adprep folder. You must run <b>adprep</b> from an elevated command prompt. To open an elevated command prompt, click <b>Start</b>, right-click <b>Command Prompt</b>, and then click <b>Run as administrator</b>. </p>
				<p>In Windows Server 2008 R2, Adprep is available in a 32-bit version and a 64-bit version. The 64-bit version runs by default. If you need to run Adprep on a 32-bit computer, run the 32-bit version (Adprep32.exe). </p>
				<p>For more information about running Adprep.exe and how to resolve errors that can occur when you run it, see <a href="http://go.microsoft.com/fwlink/?LinkID=142597" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">Running Adprep.exe</linktext></a> (http://go.microsoft.com/fwlink/?LinkID=142597).</p>
				<p>For examples of how this command can be used, see <a href="#BKMK_examples">Examples</a>.</p>
				<p>For more information about running <b>adprep /forestprep</b>, see Prepare a Windows 2000 or Windows Server 2003 Forest Schema for a Domain Controller That Runs Windows Server 2008 or Windows Server 2008 R2 (<a href="http://go.microsoft.com/fwlink/?LinkID=93242" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkID=93242</linktext></a>). </p>
				<p>For more information about running <b>adprep /domainprep /gpprep</b>, see Prepare a Windows 2000 or Windows Server 2003 Domain for a Domain Controller That Runs Windows Server 2008 or Windows Server 2008 R2 (<a href="http://go.microsoft.com/fwlink/?LinkID=93243" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkID=93243</linktext></a>). </p>
				<p>For more information about running <b>adprep /rodcprep</b>, see Prepare a Forest for a Read-Only Domain Controller (<a href="http://go.microsoft.com/fwlink/?LinkID=93244" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkID=93244</linktext></a>). </p>
			<h2 class="heading">Syntax</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>adprep {/forestprep | /domainprep | /domainprep /gpprep | /rodcprep | /wssg | /silent }</pre></td></tr></table></span></div>
				</content></div><h2 class="heading">Parameters</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Parameter
								</th>
								<th colspan="1">
									Description
								</th>
							</tr><tr>
							<td colspan="1">
								<p>/forestprep</p>
							</td>
							<td colspan="1">
								<p>Prepares a forest for the introduction of a domain controller that runs Windows Server 2008. You run this command only once in the forest. You must run this command on the domain controller that holds the schema operations master role (also known as flexible single master operations or FSMO) for the forest. You must be a member of all the following groups to run this command:</p>
								<ul><li class="unordered">
										The Enterprise Admins group<br><br>
									</li><li class="unordered">
										The Schema Admins group<br><br>
									</li><li class="unordered">
										The Domain Admins group of the domain that hosts the schema master<br><br>
									</li></ul>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/domainprep</p>
							</td>
							<td colspan="1">
								<p>Prepares a domain for the introduction of a domain controller that runs Windows Server 2008. You run this command after the <b>forestprep</b> command finishes and after the changes replicate to all the domain controllers in the forest. </p>
								<p>Run this command in each domain where you plan to add a domain controller that runs Windows Server 2008. You must run this command on the domain controller that holds the infrastructure operations master role for the domain. You must be a member of the Domain Admins group to run this command. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/domainprep /gpprep</p>
							</td>
							<td colspan="1">
								<p>Performs similar updates as <b>domainprep</b>. However, this command also provides updates that are necessary to enable Resultant Set of Policy (RSOP) Planning Mode functionality. </p>
								<p>In Active Directory environments that run Microsoft Windows® 2000, this command performs updates during off-peak hours. This minimizes replication traffic that is created in those environments by updates to file system permissions and Active Directory permissions on existing Group Policy objects (GPOs). This command is also available on Microsoft Windows Server 2003 with Service Pack 1 (SP1) or later. </p>
								<p>Run this command after the <b>forestprep</b> command finishes and after the changes replicate to all domain controllers in the forest. You must run this command on the infrastructure master for the domain. For more information about running this command in Windows 2000 Active Directory environments, see Prepare Your Infrastructure for Upgrade (<a href="http://go.microsoft.com/fwlink/?LinkId=94798" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkId=94798</linktext></a>).</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/rodcprep</p>
							</td>
							<td colspan="1">
								<p>Updates permissions on application directory partitions to enable replication of the partitions to read-only domain controllers (RODCs). This operation runs remotely; it contacts the infrastructure master in each domain to update the permissions. You need to run this command only once in the forest. However, you can rerun this command any time if it fails to complete successfully because an infrastructure master is not available. You can run this command on any computer in the forest. You must be a member of the Enterprise Admins group to run this command. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/wssg</p>
							</td>
							<td colspan="1">
								<p>Returns an expanded set of exit codes, instead of just 0 (Success) and 1 (Failure).</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/silent</p>
							</td>
							<td colspan="1">
								<p>Specifies that no standard output is returned from an operation. This parameter can be used only if <b>/wssg</b> is also used.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>quit</p>
							</td>
							<td colspan="1">
								<p>Returns to the prior menu.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Help</p>
							</td>
							<td colspan="1">
								<p>Displays Help for this command.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>?</p>
							</td>
							<td colspan="1">
								<p>Displays Help for this command.</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">Remarks</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<ul xmlns=""><li class="unordered">
							To prepare an existing Windows 2000 or Windows Server 2003 Active Directory environment for a Windows Server 2008 domain controller, be sure to run the version of Adprep that is included in the Windows Server 2008 installation media. <br><br>
						</li><li class="unordered">
							If you run Adprep on a domain controller running Windows 2000 Server, the domain controller must be running Windows 2000 Server Service Pack 4 (SP4) or later.<br><br>
						</li><li class="unordered">
							You can also perform verification steps before and after you run the <b>adprep</b> command to help ensure that the operations complete successfully. For more information, see Steps for Extending the Schema (<a href="http://go.microsoft.com/fwlink/?LinkId=94799" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkId=94799</linktext></a>). <br><br>
						</li></ul>
				</content></div><h2 class="heading">Exit Codes</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">The following table lists exit codes that Adprep can return after an operation completes.</p>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Return Code
								</th>
								<th colspan="1">
									Description
								</th>
							</tr><tr>
							<td colspan="1">
								<p>0</p>
							</td>
							<td colspan="1">
								<p>Success</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>1</p>
							</td>
							<td colspan="1">
								<p>Failure</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>2</p>
							</td>
							<td colspan="1">
								<p>Schema conflict error</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>3</p>
							</td>
							<td colspan="1">
								<p>FSMO role error</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>4</p>
							</td>
							<td colspan="1">
								<p>Connection error</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>5</p>
							</td>
							<td colspan="1">
								<p>Schema upgrade error</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>6</p>
							</td>
							<td colspan="1">
								<p>Unable to modify error</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>7</p>
							</td>
							<td colspan="1">
								<p>Server busy error</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>8</p>
							</td>
							<td colspan="1">
								<p>Permission error</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>9</p>
							</td>
							<td colspan="1">
								<p>Unable to initialize log file error</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>10</p>
							</td>
							<td colspan="1">
								<p>Not a domain controller</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>11</p>
							</td>
							<td colspan="1">
								<p>In nonnative mode </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>12</p>
							</td>
							<td colspan="1">
								<p>Need to run forest update first</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>13</p>
							</td>
							<td colspan="1">
								<p>Forest update already done</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>14</p>
							</td>
							<td colspan="1">
								<p>Domain update already done</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>15</p>
							</td>
							<td colspan="1">
								<p>GPO update already done</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>16</p>
							</td>
							<td colspan="1">
								<p>Forest update wait replication</p>
							</td>
						</tr></table>
				</content></div><a name="BKMK_examples"></a><a name="aa923ebf-de47-494b-a60a-9fce083d2f69#BKMK_examples"></a><h2 class="heading">Examples</h2><div id="sectionSection4" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">The following example prepares a forest for a domain controller that runs Windows Server 2008:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>adprep /forestprep</pre></td></tr></table></span></div>
					<p xmlns="">The following example prepares a domain for a domain controller that runs Windows Server 2008:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>adprep /domainprep</pre></td></tr></table></span></div>
					<p xmlns="">The following example prepares a domain for an RODC:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>adprep /rodcprep</pre></td></tr></table></span></div>
				</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
						</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
							<h4 class="subHeading" xmlns="">Additional references</h4><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">
										<a href="338c0381-ad63-4a4c-bd2c-42c7a93821fe.htm">Command-Line Syntax Key</a>
									</p>
								</content></div>
						</sections></div>
				</sections></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><hr><p></div></div></body></html>