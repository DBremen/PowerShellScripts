<html dir="LTR" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><meta http-equiv="Content-Type" content="text/html; CHARSET=Windows-1252"><meta name="save" content="history"><title>Setspn</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"><input type="hidden" id="hiddenScrollOffset"></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Setspn</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p>Applies To: Windows Server 2008 R2,Windows Server 2008</p>
				<p>Reads, modifies, and deletes the Service Principal Names (SPN) directory property for an Active Directory service account. You use SPNs to locate a target principal name for running a service. You can use <b>setspn</b> to view the current SPNs, reset the account's default SPNs, and add or delete supplemental SPNs.</p>
				<p>
					<b>Setspn</b> is a command-line tool that is built into Windows Server 2008. It is available if you have the Active Directory Domain Services (AD DS) server role installed. To use <b>setspn</b>, you must run the <b>setspn</b> command from an elevated command prompt. To open an elevated command prompt, click <b>Start</b>, right-click <b>Command Prompt</b>, and then click <b>Run as administrator</b>.</p>
				<p>For examples of how to use this command, see <a href="#BKMK_examples">Examples</a>.</p>
				<p>It is not usually necessary to modify SPNs. They are set up by a computer when it joins a domain and when services are installed on the computer. In some cases, however, this information can become stale. For instance, if the computer name is changed, the SPNs for installed services must be changed to match the new computer name. Also, some services and applications may require manual modification of a service account's SPN information to authenticate correctly.</p>
				<p>For more information about checking SPN registrations and troubleshooting SPNs, see <a href="http://go.microsoft.com/fwlink/?LinkId=198395" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">Service Principal Names</linktext></a> (http://go.microsoft.com/fwlink/?LinkId=198395). For more information about how a service registers SPNs and how clients compose a service’s SPN, see Service Principal Names (<a href="http://go.microsoft.com/fwlink/?LinkId=102556" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkId=102556</linktext></a>).</p>
				<p>In Active Directory, the <b>servicePrincipalName</b> attribute is a multivalued, nonlinked attribute that is built from the DNS host name. The SPN is used in the process of mutual authentication between the client and the server hosting a particular service. The client finds a computer account based on the SPN of the service to which it is trying to connect. </p>
				<p>To perform the tasks that are described in the following sections, you must have membership in Domain Admins, Enterprise Admins, or you must have been delegated the appropriate authority. For information on delegating the permissions to modify SPNs, see <a href="#BKMK_Del">Delegating Authority to Modify SPNs</a>.</p>
				<p>The following sections describe how to run basic Setspn.exe commands. For additional information about the options for Setspn.exe, see <a href="#BKMK_Syn">Setspn Syntax</a>, <a href="#BKMK_Rem">Setspn Remarks</a>, and <a href="#BKMK_examples">Setspn Examples</a>.</p>
			<h2 class="heading">SPN format</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">When you manipulate SPNs with the <b>setspn</b>, the SPN must be entered in the correct format. The format of an SPN is <i>serviceclass</i>/host:<i>port</i>/<i>servicename</i>, in which each item represents a name or value. Unless the service name and port are not standard, you do not have to enter them when you use <b>setspn</b>. For example, the default SPNs for a server named WS2003A that is providing remote desktop (RDP) services over the default port (TCP 3389) register the following two SPNs in its own Active Directory computer object:</p>
					<p xmlns="">
						<code>TERMSRV/WS2003A</code>
					</p>
					<p xmlns="">
						<code>TERMSRV/WS2003A.cpandl.com</code>
					</p>
					<p xmlns="">The examples in the following sections assume that the default port and service name are used for SPNs, which is the typical situation. However, if you need to specify a nonstandard SPN configuration, see Name Formats for Unique SPNs</p>
					<p xmlns="">(<a href="http://go.microsoft.com/fwlink/?LinkId=102555" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkId=102555</linktext></a>). </p>
				</content></div><h2 class="heading">Viewing SPNs</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">To view a list of the SPNs that a computer has registered with Active Directory from a command prompt, use the <b>setspn –l</b> <i>hostname</i> command, where <i>hostname</i> is the actual host name of the computer object that you want to query. </p>
					<div class="alert" xmlns=""><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
						To find the host name for a computer from a command prompt, type <b>hostname</b>, and then press ENTER. <p>
					</td></tr></table><p></div>
					<p xmlns="">For example, to list the SPNs of a computer named WS2003A, at the command prompt, type <b>setspn -l S2003A</b>, and then press ENTER. A domain controller named WS2003A in Cpandl.com, which is also functioning as a global catalog server and Domain Name System (DNS) server, registers the following SPNs:</p>
					<p xmlns="">
						<code>Registered ServicePrincipalNames for CN=WS2003A,OU=Domain Controllers,DC=cpandl,DC=com:</code>
					</p>
					<p xmlns="">
						<code>ldap/WS2003A.cpandl.com/ForestDnsZones.cpandl.com</code>
					</p>
					<p xmlns="">
						<code>ldap/WS2003A.cpandl.com/DomainDnsZones.cpandl.com</code>
					</p>
					<p xmlns="">
						<code>NtFrs-88f5d2bd-b646-11d2-a6d3-00c04fc9b232/WS2008A.cpandl.com</code>
					</p>
					<p xmlns="">
						<code>DNS/WS2003A.cpandl.com</code>
					</p>
					<p xmlns="">
						<code>GC/WS2003A.cpandl.com/cpandl.com</code>
					</p>
					<p xmlns="">
						<code>HOST/WS2003A.cpandl.com/CPANDL</code>
					</p>
					<p xmlns="">
						<code>HOST/WS2003A</code>
					</p>
					<p xmlns="">
						<code>HOST/WS2003A.cpandl.com</code>
					</p>
					<p xmlns="">
						<code>HOST/WS2003A.cpandl.com/cpandl.com</code>
					</p>
					<p xmlns="">
						<code>E3514235-4B06-11D1-AB04-00C04FC2DCD2/70906edd-c8a5-4b7d-8198-4f970f7b9f52/cpandl.com</code>
					</p>
					<p xmlns="">
						<code>ldap/70906edd-c8a5-4b7d-8198-4f970f7b9f52._msdcs.cpandl.com</code>
					</p>
					<p xmlns="">
						<code>ldap/WS2003A.cpandl.com/CPANDL</code>
					</p>
					<p xmlns="">
						<code>ldap/WS2003A</code>
					</p>
					<p xmlns="">
						<code>ldap/WS2003A.cpandl.com</code>
					</p>
					<p xmlns="">
						<code>ldap/WS2003A.cpandl.com/cpandl.com</code>
					</p>
					<p xmlns="">The globally unique identifier (GUID) 70906edd-c8a5-4b7d-8198-4f970f7b9f52 identifies the NTDS Settings object of the domain controller (NTDS-DSA), which is unique for each domain controller. The other two GUIDs, NtFrs-88f5d2bd-b646-11d2-a6d3-00c04fc9b232 and E3514235-4B06-11D1-AB04-00C04FC2DCD2, identify the File Replication Service (NTFRS) and the Directory Replication Service (DRS) remote procedure call (RPC), respectively, and they are standard SPNs for all domain controllers.</p>
					<div class="alert" xmlns=""><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
						If constrained delegation is in use on a Windows Server 2003 computer that requires an SPN modification, some SPNs may not appear. For more information, see article 936628 in the Microsoft Knowledge Base (<a href="http://go.microsoft.com/fwlink/?LinkID=102306" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkID=102306</linktext></a>).<p>
					</td></tr></table><p></div>
				</content></div><h2 class="heading">Resetting SPNs</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">If the SPNs that you see for your server display what seems to be incorrect names; consider resetting the computer to use the default SPNs. To reset the default SPN values, use the <b>setspn -r</b> <i>hostname</i> command at a command prompt, where <i>hostname</i> is the actual host name of the computer object that you want to update. </p>
					<p xmlns="">For example, to reset the SPNs of a computer named server2, type <b>setspn -r server2</b>, and then press ENTER. You receive confirmation if the reset is successful. To verify that the SPNs are displayed correctly, type <b>setspn -l server2</b>, and then press ENTER.</p>
					<div class="alert" xmlns=""><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
						For information related to troubleshooting SPN issues, see Service Logons Fail Due to Incorrectly Set SPNs (<a href="http://go.microsoft.com/fwlink/?LinkId=102554" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">http://go.microsoft.com/fwlink/?LinkId=102554</linktext></a>).<p>
					</td></tr></table><p></div>
				</content></div><h2 class="heading">Adding SPNs</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">To add an SPN, use the <b>setspn -a</b> <i>service/name</i> <i>hostname</i> command at a command prompt, where <i>service/name</i> is the SPN that you want to add and <i>hostname</i> is the actual host name of the computer object that you want to update. For example, if there is an Active Directory domain controller with the host name server1.contoso.com that requires an SPN for the Lightweight Directory Access Protocol (LDAP), type <b>setspn -a ldap/server1.contoso.com server1</b>, and then press ENTER to add the SPN.</p>
				</content></div><h2 class="heading">Removing SPNs</h2><div id="sectionSection4" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">To remove an SPN, use the <b>setspn -d</b> <i>service/name</i> <i>hostname</i> command at a command prompt, where <i>service/name</i> is the SPN that is to be removed and <i>hostname</i> is the actual host name of the computer object that you want to update. For example, if the SPN for the Web service on a computer named Server3.contoso.com is incorrect, you can remove it by typing <b>setspn -d http/server3.contoso.com server3</b>, and then pressing ENTER.</p>
				</content></div><a name="BKMK_Del"></a><a name="9341c753-11ff-4acc-993c-b05d50f32330#BKMK_Del"></a><h2 class="heading">Delegating Authority to Modify SPNs</h2><div id="sectionSection5" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">If you need to allow delegated administrators to configure service principal names (SPNs), you must ensure that their user accounts have the <b>Validated write to service principle name </b>permission.</p>
					<p xmlns="">Membership in <b>Domain Admins</b>, or equivalent, is the minimum required to complete this procedure. Review details about using the appropriate accounts and group memberships at <a href="http://go.microsoft.com/fwlink/?LinkId=83477" alt="" target="_blank"><maml:linktext xmlns:maml="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">Local and Domain Default Groups</maml:linktext></a> (http://go.microsoft.com/fwlink/?LinkId=83477). </p>
					<h4 class="subHeading" xmlns=""><b>To grant permission to modify SPNs</b></h4><div class="subSection" xmlns=""><ddue:steps xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5"><ol class="ordered" xmlns=""><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">Open Active Directory Users and Computers. </p>
									<p xmlns="">To open Active Directory Users and Computers, click <b>Start</b>, click <b>Run</b>, type <b>dsa.msc</b>, and then press ENTER.</p>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">Click <b>View</b>, and verify that the <b>Advanced Features</b> check box is selected. </p>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">Click <b>Advanced Features</b>, if it is not selected. </p>
									<p xmlns="">If the domain to which you want to allow a disjoint namespace does not appear in the console, take the following steps:</p>
									<ol class="ordered" xmlns=""><li>
											In the console tree, right-click Active Directory Users and Computers, and then click <b>Connect to Domain</b>. <br><br>
										</li><li>
											In the <b>Domain</b> box, type the name of the Active Directory domain to which you want to allow the disjoint namespace, and then click <b>OK</b>.<br><br>
											As an alternative, you can use the <b>Browse</b> button to locate the Active Directory domain.<br><br>
										</li></ol>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">In the console tree, right-click the node that represents the domain to which you want to allow a disjoint namespace, and then click <b>Properties</b>. </p>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">On <b>Security</b> tab, click <b>Advanced</b>.</p>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">On the <b>Permissions</b> tab, click <b>Add</b>.</p>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">In <b>Enter the object name to select</b>, type the group or user account name to which you want to delegate permission, and then click <b>OK</b>.</p>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">Configure the <b>Apply onto</b> box for <b>Computer objects</b>.</p>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">At the bottom of the <b>Permissions</b> box, select the <b>Allow</b> check box that corresponds to the <b>Validated write to service principal name</b> permissions, and then click <b>OK</b> on the three open dialog boxes to confirm your changes.</p>
								</content>
							</li><li>
								<content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">Close Active Directory Users and Computers.</p>
								</content>
							</li></ol></ddue:steps></div>
				</content></div><a name="BKMK_Syn"></a><a name="9341c753-11ff-4acc-993c-b05d50f32330#BKMK_Syn"></a><h2 class="heading">Syntax</h2><div id="sectionSection6" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn &lt;Computer&gt; [-l] [-r] [-a &lt;SPN&gt;] [-d &lt;SPN&gt;] [-s &lt;SPN&gt;] [-?]</pre></td></tr></table></span></div>
				</content><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">In Windows Server 2008 R2 and Windows Server 2008, Setspn.exe has Edit Mode switches and modifiers and Query Mode switches and modifiers. The syntax is:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn [modifiers switch] [accountname]</pre></td></tr></table></span></div>
					<p xmlns="">Where [accountname] can be the name or domain\name of the target computer or user account. </p>
				</content></div><h2 class="heading">Parameters</h2><div id="sectionSection7" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Edit Mode Parameters
								</th>
								<th colspan="1">
									Description
								</th>
							</tr><tr>
							<td colspan="1">
								<p>
									<i>&lt;Computer&gt; </i>
								</p>
							</td>
							<td colspan="1">
								<p>Specifies the desired Active Directory account object for which to configure the Service Principal Names (SPN). Normally, this is the NetBIOS name of the computer and optionally the domain that contains the computer account. However, any desired Active Directory object name can be used.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>-l<b> </b></p>
							</td>
							<td colspan="1">
								<p>Lists the currently registered SPN for computer. </p>
								<p>Usage: setspn –l accountname</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p> -r</p>
							</td>
							<td colspan="1">
								<p>Resets the default SPN registrations for the host names for Computer.</p>
								<p>Usage: setspn –r accountname</p>
								<p>For example, to register SPN "HOST/daserver1" and "HOST/{DNS of daserver1}":</p>
								<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn -R daserver1</pre></td></tr></table></span></div>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>-a &lt;<i>SPN&gt;</i></p>
							</td>
							<td colspan="1">
								<p>Adds the specified SPN for the Computer.</p>
								<p>Usage: setspn – a SPN accountname</p>
								<p>For example, to register SPN "http/daserver" for computer "daserver1":</p>
								<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn -A http/daserver daserver1</pre></td></tr></table></span></div>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>-d &lt;<i>SPN&gt;</i></p>
							</td>
							<td colspan="1">
								<p>Deletes the specified SPN for the Computer.</p>
								<p>Usage: setspn –d SPN accountname</p>
								<p>For example, to delete SPN "http/daserver" for computer "daserver1":</p>
								<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn -D http/daserver daserver1</pre></td></tr></table></span></div>
							</td>
						</tr><tr>
							<td>
								<p>-s &lt;<i>SPN</i>&gt;</p>
							</td>
							<td>
								<p>Adds the specified SPN after verifying that no duplicates exist.</p>
								<p>Usage: setspn –s SPN accountname</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>-? </p>
							</td>
							<td colspan="1">
								<p>Displays help at the command prompt. This parameter is the default: if you run setspn run without this parameter displays the SPN command-line usage.</p>
							</td>
						</tr></table>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
							<td>
								<p>Edit Mode modifiers</p>
							</td>
							<td>
								<p>Description</p>
							</td>
						</tr><tr>
							<td>
								<p>-C</p>
							</td>
							<td>
								<p>Specify that accountname is a computer account.</p>
							</td>
						</tr><tr>
							<td>
								<p>-U</p>
							</td>
							<td>
								<p>Specify that accountname is a user account.</p>
								<p>For example, to register SPN "http/daserver" for user account "dauser":</p>
								<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn -U -A http/daserver dauser</pre></td></tr></table></span></div>
							</td>
						</tr></table>
					<div class="alert" xmlns=""><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
						-C and -U are exclusive. If neither is specified, the tool will interpret accountname as a computer name if such a computer exists, and a user name if it does not.<p>
					</td></tr></table><p></div>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
							<td>
								<p>Query Mode Parameters</p>
							</td>
							<td>
								<p>Description</p>
							</td>
						</tr><tr>
							<td>
								<p>-Q &lt;<i>SPN</i>&gt;</p>
							</td>
							<td>
								<p>Query for existence of SPN.</p>
								<p>Usage: setspn -Q SPN</p>
							</td>
						</tr><tr>
							<td>
								<p>-X</p>
								<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
									Searching for duplicates, especially forest-wide, can take a long period of time and a large amount of memory.<p>
								</td></tr></table><p></div>
							</td>
							<td>
								<p>Search for duplicate SPNs.</p>
								<p>Usage: setspn -X</p>
							</td>
						</tr></table>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
							<td>
								<p>Query Mode modifiers</p>
							</td>
							<td>
								<p>Description</p>
							</td>
						</tr><tr>
							<td>
								<p>-F</p>
							</td>
							<td>
								<p>Perform queries at the forest, rather than domain level.</p>
								<p>For example, to register SPN "http/daserver" for computer "daserver1" if no such SPN exists in the forest:</p>
								<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn -F -S http/daserver daserver1</pre></td></tr></table></span></div>
							</td>
						</tr><tr>
							<td>
								<p>-T</p>
							</td>
							<td>
								<p>Perform query on the specified domain or forest (when -F is also used).</p>
								<p>Usage: setspn -T domain (switches and other parameters). Use "" or * to indicate the current domain or forest.</p>
								<p>For example, to report all duplicate registration of SPNs in this domain and contoso domain:</p>
								<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn -T * -T contoso -X</pre></td></tr></table></span></div>
								<p>To find all SPNs of the form */daserver registered in the forest to which contoso domain belongs:</p>
								<div class="code"><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>setspn -T contoso -F -Q */daserver</pre></td></tr></table></span></div>
							</td>
						</tr></table>

</content></div><a name="BKMK_Rem"></a><a name="9341c753-11ff-4acc-993c-b05d50f32330#BKMK_Rem"></a><h2 class="heading">Remarks</h2><div id="sectionSection8" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<ul xmlns=""><li class="unordered">
							Query Mode modifiers can be used with the -S switch in order to specify where the check for duplicates should be performed before adding the SPN.<br><br>
						</li><li class="unordered">
							-T can be specified multiple times. -Q will execute on each target domain or forest. -X will return duplicates that exist across all targets. Service Principal Names (SPNs) are not required to be unique across forests, but duplicate SPNs can cause authentication issues during cross-forest authentication.<br><br>
						</li><li class="unordered">
							SPNs can only be constructed by using the account base name as the <i>Computer</i> parameter. The directory service enforces this by generating a constraint violation error. <br><br>
							You may not have the rights to access or modify this property on some account objects. You can determine what your access rights are by viewing the security attributes of the account object using the Microsoft Management Console (MMC) in Active Directory Users and Computers. You can also delegate the permission by assigning the Validated write to service principal name permission to the desired user or group.<br><br>
						</li><li class="unordered">
							The built-in SPNs that are recognized for computer accounts are:<br><br>
							<h3 class="subHeading"></h3><table><tr>
									<td colspan="1">
										<p>alerter</p>
										<p>appmgmt</p>
										<p>browser</p>
										<p>cifs</p>
										<p>cisvc</p>
										<p>clipsrv</p>
										<p>dcom</p>
										<p>dhcp</p>
										<p>dmserver</p>
										<p>dns</p>
										<p>dnscache</p>
									</td>
									<td colspan="1">
										<p>eventlog</p>
										<p>eventsystem</p>
										<p>fax</p>
										<p>http</p>
										<p>ias</p>
										<p>iisadmin</p>
										<p>messenger</p>
										<p>msiserver</p>
										<p>mcsvc</p>
										<p>netdde</p>
										<p>netddedsm</p>
									</td>
									<td colspan="1">
										<p>netlogon</p>
										<p>netman</p>
										<p>nmagent</p>
										<p>oakley</p>
										<p>plugplay</p>
										<p>policyagent</p>
										<p>protectedstorage</p>
										<p>rasman</p>
										<p>remoteaccess</p>
										<p>replicator</p>
									</td>
									<td colspan="1">
										<p>rpc</p>
										<p>rpclocator</p>
										<p>rpcss</p>
										<p>rsvp</p>
										<p>samss</p>
										<p>scardsvr</p>
										<p>scesrv</p>
										<p>schedule</p>
										<p>scm</p>
										<p>seclogon</p>
									</td>
									<td colspan="1">
										<p>snmp</p>
										<p>spooler</p>
										<p>tapisrv</p>
										<p>time</p>
										<p>trksvr</p>
										<p>trkwks</p>
										<p>ups</p>
										<p>w3svc</p>
										<p>wins</p>
										<p>www</p>
									</td>
								</tr></table>
							These SPNs are recognized for computer accounts if the computer has a host SPN. Unless they are explicitly placed on objects, a host SPN can substitute for any of the above SPNs.<br><br>
						</li><li class="unordered">
							Service Principal Names (SPNs) are not case sensitive when used by Microsoft Windows-based computers. However, an SPN can be used by any type of computer system. Many of these computer systems, especially UNIX-based systems, are case-sensitive and require the proper case to function properly. Care should be taken to use the proper case particularly when an SPN can be used by a non-Windows-based computer.<br><br>
						</li></ul>
				</content></div><a name="BKMK_examples"></a><a name="9341c753-11ff-4acc-993c-b05d50f32330#BKMK_examples"></a><h2 class="heading">Examples</h2><div id="sectionSection9" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">
						<b>Example 1: List currently registered SPNs</b>
					</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>
						<b>setspn -l daserver1</b>
Registered ServicePrincipalNames for CN=DASERVER1,CN=Computers,DC=reskit,DC=contoso,DC=com:
HOST/daserver1
HOST/daserver1.reskit.contoso.com
</pre></td></tr></table></span></div>
					<p xmlns="">
						<b>Example 2: Reset default registered SPNs</b>
					</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>
						<b>setspn -r daserver1</b>
Registering ServicePrincipalNames for CN=DASERVER1,CN=Computers,DC=reskit,DC=contoso,DC=com
HOST/daserver1.reskit.contoso.com
HOST/daserver1
Updated object
</pre></td></tr></table></span></div>
					<p xmlns="">
						<b>Example 3: Add a new SPN</b>
					</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>
						<b>setspn -a http/daserver1.reskit.contoso.com daserver1</b>
Registering ServicePrincipalNames for CN=DASERVER1,CN=Computers,DC=reskit,DC=contoso,DC=com
http/daserver1.reskit.contoso.com
Updated object
</pre></td></tr></table></span></div>
					<p xmlns="">
						<b>Example 4: Remove an SPN</b>
					</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>
						<b>setspn -d http/daserver1.reskit.contoso.com daserver1</b>
Unregistering ServicePrincipalNames for CN=DASERVER1,CN=Computers,DC=reskit,DC=contoso,DC=com
http/daserver1.reskit.contoso.com
Updated object
</pre></td></tr></table></span></div>
				</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
						</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
							<h4 class="subHeading" xmlns="">Additional references</h4><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">
										<a href="338c0381-ad63-4a4c-bd2c-42c7a93821fe.htm">Command-Line Syntax Key</a>
									</p>
								</content></div>
						</sections></div>
				</sections></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><hr><p></div></div></body></html>