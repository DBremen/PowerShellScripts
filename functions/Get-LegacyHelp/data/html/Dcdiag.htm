<html dir="LTR" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><meta http-equiv="Content-Type" content="text/html; CHARSET=Windows-1252"><meta name="save" content="history"><title>Dcdiag</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"><input type="hidden" id="hiddenScrollOffset"></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Dcdiag</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p>Applies To: Windows Server 2003,Windows Server 2003 R2,Windows Server 2008,Windows Server 2003 with SP1</p>
				<p>Analyzes the state of domain controllers in a forest or enterprise and reports any problems to help in troubleshooting. </p>
				<p>As an end-user reporting program, <b>dcdiag</b> is a command-line tool that encapsulates detailed knowledge of how to identify abnormal behavior in the system. <b>Dcdiag</b> displays command output at the command prompt.</p>
				<p>
					<b>Dcdiag</b> consists of a framework for executing tests and a series of tests to verify different functional areas of the system. This framework selects which domain controllers are tested according to scope directives from the user, such as enterprise, site, or single server.</p>
				<p>
					<b>Dcdiag</b> is built into Windows Server 2008 R2 and Windows Server 2008. It is available if you have the Active Directory Domain Services (AD DS) or Active Directory Lightweight Directory Services (AD LDS) server role installed. It is also available if you install the Active Directory Domain Services Tools that are part of the Remote Server Administration Tools (RSAT). For more information, see <a href="http://go.microsoft.com/fwlink/?LinkID=177813" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">How to Administer Microsoft Windows Client and Server Computers Locally and Remotely</linktext></a> (http://go.microsoft.com/fwlink/?LinkID=177813). </p>
				<p>If Dcdiag takes a long time to run on a computer that runs Windows Server 2008 R2 or Windows 7, install the hotfix in <a href="http://go.microsoft.com/fwlink/?LinkId=196596" alt="" target="_blank"><linktext xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">article 979294</linktext></a> (http://go.microsoft.com/fwlink/?LinkId=196596) in the Microsoft Knowledge Base.</p>
				<p>To use <b>dcdiag</b>, you must run the <b>dcdiag</b> command from an elevated command prompt. To open an elevated command prompt, click <b>Start</b>, right-click <b>Command Prompt</b>, and then click <b>Run as administrator</b>.</p>
				<p>For examples of how to use this command, see <a href="#BKMK_examples">Examples</a>.</p>
			<h2 class="heading">Syntax</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>dcdiag [/s:&lt;DomainController&gt;] [/n:&lt;NamingContext&gt;] [/u:&lt;Domain&gt;\&lt;UserName&gt; /p:{* | &lt;Password&gt; | ""}] [{/a | /e}] [{/q | /v}] [/i] [/f:&lt;LogFile&gt;] [/c [/skip:&lt;Test&gt;]] [/test:&lt;Test&gt;] [/fix] [{/h | /?}] [/ReplSource:&lt;SourceDomainController&gt;]</pre></td></tr></table></span></div>
				</content></div><h2 class="heading">Parameters</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Parameter
								</th>
								<th colspan="1">
									Description
								</th>
							</tr><tr>
							<td colspan="1">
								<p>/s:&lt;DomainController&gt; </p>
							</td>
							<td colspan="1">
								<p>Specifies the name of the server to run the command against. If this parameter is not specified, the tests are run against the local domain controller. This parameter is ignored for DcPromo and RegisterInDns tests, which can be run locally only.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/n:&lt;NamingContext&gt; </p>
							</td>
							<td colspan="1">
								<p>Uses <i>NamingContext</i> as the naming context to test. You can specify domains in NetBIOS, Domain Name System (DNS), or distinguished name format. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/u:&lt;Domain&gt;\&lt;UserName&gt; /p:{* | &lt;Password&gt; | ""} </p>
							</td>
							<td colspan="1">
								<p>Uses <i>Domain</i>\<i>UserName</i>. <b>Dcdiag</b> uses the current credentials of the user (or process) that is logged on. If alternate credentials are needed, use the following options to provide those credentials for binding with <i>Password</i> as the password:</p>
								<ul><li class="unordered">
										Use quotation marks ("") for an empty or null password.<br><br>
									</li><li class="unordered">
										Use the wildcard character (<b>*</b>) to prompt for the password. <br><br>
									</li></ul>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/a </p>
							</td>
							<td colspan="1">
								<p>Tests all the servers on this site. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/e </p>
							</td>
							<td colspan="1">
								<p>Tests all the servers in the enterprise. Overrides <b>/a</b>. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/q </p>
							</td>
							<td colspan="1">
								<p>Quiet. Prints only error messages. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/v </p>
							</td>
							<td colspan="1">
								<p>Verbose. Prints extended information. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/i </p>
							</td>
							<td colspan="1">
								<p>Ignores superfluous error messages. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/fix </p>
							</td>
							<td colspan="1">
								<p>Affects the <i>MachineAccount</i> test only. This parameter causes the test to fix the Service Principal Names (SPNs) on the Machine Account object of the domain controller. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/f:&lt;LogFile&gt; </p>
							</td>
							<td colspan="1">
								<p>Redirects all output to a log file (<i>LogFile)</i>. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/c </p>
							</td>
							<td colspan="1">
								<p>Comprehensive. Runs all tests except DCPromo and RegisterInDNS, including non-default tests. Optionally, you can use this parameter with the /skip parameter to skip specified tests. </p>
								<p>The following tests are not run by default:</p>
								<ul><li class="unordered">
										Topology<br><br>
									</li><li class="unordered">
										CutoffServers<br><br>
									</li><li class="unordered">
										OutboundSecureChannels<br><br>
									</li></ul>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>{/h | /?} </p>
							</td>
							<td colspan="1">
								<p>Displays help at the command prompt.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/test:&lt;Test&gt; </p>
							</td>
							<td colspan="1">
								<p>Runs this test only. The Connectivity test, which you cannot skip, is also run. You should not have this parameter in the same command with the <b>/skip</b> parameter.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>/ReplSource:&lt;SourceDomainController&gt;</p>
							</td>
							<td colspan="1">
								<p>Tests the connection between the domain controller on which you run the command and the source domain controller. (This parameter is used for the CheckSecurityError test.) <i>SourceDomainController</i> is the DNS name, NetBIOS name, or distinguished name of a real or potential server that will be the source domain controller for replication, as represented by a real or potential connection object.</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">DNS Test Syntax</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">The Dcdiag DNS test uses the following syntax:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>dcdiag /test:DNS [/DnsBasic | /DnsForwarders | /DnsDelegation | /DnsDynamicUpdate | /DnsRecordRegistration | /DnsResolveExtName [/DnsInternetName:&lt;InternetName&gt;] | /DnsAll] [/f:&lt;LogFile&gt;] [/x:&lt;XMLLog.xml&gt;] [/xsl:&lt;XSLFile.xsl&gt; or &lt;XSLTFile.xslt&gt;] [/s:&lt;DomainController&gt;] [/e] [/v]</pre></td></tr></table></span></div>
				</content></div><h2 class="heading">DNS Test Parameters</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<dl xmlns=""><dt>
							<b>/test:DNS</b> [<i>DNS test</i>]</dt><br><dd>
							Performs the specified DNS test. If no test is specified, defaults to <b>/DnsAll</b>.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/DnsBasic</b>
						</dt><br><dd>
							Performs basic DNS tests, including network connectivity, DNS client configuration, service availability, and zone existence.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/DnsForwarders</b>
						</dt><br><dd>
							Performs the <b>/DnsBasic</b> tests, and also checks the configuration of forwarders.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/DnsDelegation</b>
						</dt><br><dd>
							Performs the <b>/DnsBasic</b> tests, and also checks for proper delegations.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/DnsDynamicUpdate</b>
						</dt><br><dd>
							Performs <b>/DnsBasic</b> tests, and also determines if dynamic update is enabled in the Active Directory zone.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/DnsRecordRegistration</b>
						</dt><br><dd>
							Performs the <b>/DnsBasic</b> tests, and also checks if the address (A), canonical name (CNAME) and well-known service (SRV) resource records are registered. In addition, creates an inventory report based on the test results.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/DnsResolveExtName</b> <b>[/DnsInternetName:&lt;</b>InternetName&gt;]</dt><br><dd>
							Performs the <b>/DnsBasic</b> tests, and also attempts to resolve <i>InternetName</i>. If <b>/DnsInternetName</b> is not specified, attempts to resolve the name www.microsoft.com. If <b>/DnsInternetName</b> is specified, attempts to resolve the Internet name supplied by the user.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/DnsAll</b>
						</dt><br><dd>
							Performs all tests, except for the /DnsResolveExtName test, and generates a report. <p>
						</dd></dl><dl xmlns=""><dt>
							<b>/f:&lt;</b>LogFile&gt;</dt><br><dd>
							Redirects all output to <i>LogFile</i>. <p>
						</dd></dl><dl xmlns=""><dt>
							<b>/s:&lt;</b>DomainController&gt;</dt><br><dd>
							Runs the tests against <i>DomainController</i>. If this parameter is not specified, the tests are run against the local domain controller. <p>
						</dd></dl><dl xmlns=""><dt>
							<b>/e</b>
						</dt><br><dd>
							Runs all tests specified by <b>/test:DNS</b> against all domain controllers in the Active Directory forest.<p>
							<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
								Run times for DNS tests can be significant in large enterprises when the <code>/e</code> parameter is used. Domain controllers and DNS servers that are offline will increase run time as a result of long-time out periods for RPC and other protocols.<p>
							</td></tr></table><p></div>
						</dd></dl><dl xmlns=""><dt>
							<b>/v</b>
						</dt><br><dd>
							Verbose. Presents extended information about successful test results, in addition to information about errors and warnings. When the <b>/v</b> parameter is not used, provides only error and warning information. Use the <b>/v</b> switch when errors or warnings are reported in the summary table.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/x:</b>&lt;XMLLog.xml&gt;</dt><br><dd>
							Redirects all output to &lt;XMLLog.xml&gt;. This parameter works only with the <b>/test:dns</b> option.<p>
						</dd></dl><dl xmlns=""><dt>
							<b>/xsl:</b>&lt;XSLFile.xsl&gt; or &lt;XSLTFile.xslt&gt;</dt><br><dd>
							Adds the processing instructions that reference the specified stylesheet. This parameter works only with <b>/test:dns</b> <b>/x:</b>&lt;XMLLog.xml&gt; option.<p>
						</dd></dl>
				</content></div><h2 class="heading">Dcdiag tests</h2><div id="sectionSection4" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">The tables in this section show tests that you can run by using <b>dcdiag</b>. The tests are grouped into the following categories: </p>
					<ul xmlns=""><li class="unordered">
							Domain controller tests that you cannot skip<br><br>
						</li><li class="unordered">
							Domain controller tests that you can skip<br><br>
							These tests are grouped into two tables based on whether they run by default.<br><br>
						</li><li class="unordered">
							Non-domain controller tests<br><br>
						</li></ul>
				</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
						</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
							<h4 class="subHeading" xmlns="">Domain controller tests that you cannot skip</h4><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<dl xmlns=""><dt>Connectivity</dt><br><dd>
											Checks if domain controllers are registered in DNS, if they can be pinged and if they have LDAP or remote procedure call (RPC) connectivity. <p>
										</dd></dl>
								</content></div>
							<h4 class="subHeading" xmlns="">Domain controller tests that you can skip</h4><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">The following table shows tests that run by default.</p>
									<dl xmlns=""><dt>Replications</dt><br><dd>
											Checks for timely replication and any replication errors between domain controllers.<p>
										</dd></dl><dl xmlns=""><dt>NCSecDesc</dt><br><dd>
											Checks that the security descriptors on the naming context heads have appropriate permissions for replication.<p>
										</dd></dl><dl xmlns=""><dt>NetLogons</dt><br><dd>
											Checks that the appropriate logon privileges exist to allow replication to proceed.<p>
										</dd></dl><dl xmlns=""><dt>Advertising</dt><br><dd>
											Checks whether each domain controller advertises itself in the roles that it should be capable of performing. This test fails if the Netlogon Service has stopped or failed to start.<p>
										</dd></dl><dl xmlns=""><dt>KnowsOfRoleHolders</dt><br><dd>
											Checks whether the domain controller can contact the servers that hold the five operations master roles (also known as flexible single master operations or FSMO roles).<p>
										</dd></dl><dl xmlns=""><dt>Intersite</dt><br><dd>
											Checks for failures that would prevent or temporarily hold up intersite replication and predicts how long it would take for the Knowledge Consistency Checker (KCC) to recover. <p>
											<div class="alert"><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/Important.gif">Important </th></tr><tr><td>
												Results of this test are often not valid, especially in atypical site or KCC configurations or at the Windows Server 2003 forest functional level.<p>
											</td></tr></table><p></div>
										</dd></dl><dl xmlns=""><dt>FSMOCheck</dt><br><dd>
											Checks that the domain controller can contact a Kerberos Key Distribution Center (KDC), a time server, a preferred time server, a primary domain controller (PDC), and a global catalog server. This test does not test any of the servers for operations master roles.<p>
										</dd></dl><dl xmlns=""><dt>RidManager</dt><br><dd>
											Checks whether the relative identifier (RID) master is accessible and if it contains the proper information. <p>
										</dd></dl><dl xmlns=""><dt>MachineAccount</dt><br><dd>
											Checks whether the machine account has properly registered and that the services are advertised. Use the /RecreateMachineAccount parameter to attempt a repair if the local machine account is missing. Use the <b>/FixMachineAccount</b> parameter if the machine account flags are incorrect.<p>
										</dd></dl><dl xmlns=""><dt>Services</dt><br><dd>
											Checks whether the appropriate domain controller services are running.<p>
										</dd></dl><dl xmlns=""><dt>OutboundSecureChannels</dt><br><dd>
											Checks that secure channels exist from all of the domain controllers in the domain to the domains that are specified by the <b>/testdomain </b>parameter. The <b>/nositerestriction</b> parameter prevents dcdiag from limiting the test to the domain controllers in the site.<p>
										</dd></dl><dl xmlns=""><dt>ObjectsReplicated</dt><br><dd>
											Checks that the Machine Account and Directory System Agent (DSA) objects have replicated. You can use the <b>/objectdn:</b><i>dn</i> parameter with the <b>/n:</b><i>nc</i> parameter to specify an additional object to check.<p>
										</dd></dl><dl xmlns=""><dt>frssysvol</dt><br><dd>
											Checks that the file replication system (FRS) system volume (SYSVOL) is ready.<p>
										</dd></dl><dl xmlns=""><dt>frsevent</dt><br><dd>
											Checks to see if there are errors in the file replication system. (Failing replication of the SYSVOL share can cause policy problems.)<p>
										</dd></dl><dl xmlns=""><dt>kccevent</dt><br><dd>
											Checks that the KCC is completing without errors.<p>
										</dd></dl><dl xmlns=""><dt>systemlog</dt><br><dd>
											Checks that the system is running without errors.<p>
										</dd></dl><dl xmlns=""><dt>CheckSDRefDom</dt><br><dd>
											Checks that all application directory partitions have appropriate security descriptor reference domains.<p>
										</dd></dl><dl xmlns=""><dt>VerifyReplicas</dt><br><dd>
											Checks that all application directory partitions are fully instantiated on all replica servers.<p>
										</dd></dl><dl xmlns=""><dt>CrossRefValidation</dt><br><dd>
											Checks the validity of cross-references.<p>
										</dd></dl><dl xmlns=""><dt>VerifyReferences</dt><br><dd>
											Checks that certain system references are intact for the FRS and replication infrastructure.<p>
										</dd></dl><dl xmlns=""><dt>VerifyEnterpriseReferences</dt><br><dd>
											Checks that specified system references are intact for the FRS and replication infrastructure across all objects in the enterprise on each domain controller.<p>
										</dd></dl><dl xmlns=""><dt>/skip:&lt;Test&gt;</dt><br><dd>
											Skips the specified test. You should not specify this parameter in the same command with the <b>/test </b>parameter. The only test that you cannot skip is Connectivity.<p>
										</dd></dl>
									<p xmlns="">The following table shows tests that do not run by default.</p>
									<dl xmlns=""><dt>Topology</dt><br><dd>
											Checks that the KCC has generated a fully connected topology for all domain controllers.<p>
										</dd></dl><dl xmlns=""><dt>CheckSecurityError</dt><br><dd>
											Reports on the overall health of replication with respect to Active Directory security in domain controllers running Windows Server 2003 SP1. You can perform this test against one or all domain controllers in an enterprise. When the test finishes, <b>dcdiag</b> presents a summary of the results, along with detailed information for each domain controller tested and the diagnosis of security errors that the test reported.<p>
											The following argument is optional:<p>
											
												<b>/ReplSource:</b>
												<i>SourceDomainController</i>
											<p>
											This argument checks the ability to create a replication link between a real or potential source domain controller (<i>SourceDomainController</i>) and the local domain controller.<p>
										</dd></dl><dl xmlns=""><dt>CutoffServers</dt><br><dd>
											Checks for any server that is not receiving replications because its partners are not running.<p>
										</dd></dl><dl xmlns=""><dt>DNS</dt><br><dd>
											Includes six optional DNS-related tests, as well as the Connectivity test, which runs by default. You can run the tests individually or together. The tests include the following parameters:<p>
											<ul><li class="unordered">
													
														<b>/DnsBasic</b>
													<br><br>
													Confirms that essential services are running and available, necessary resource records are registered, and domain and root zones are present.<br><br>
												</li><li class="unordered">
													
														<b>/DnsForwarders</b>
													<br><br>
													Determines whether recursion is enabled and that any configured forwarders or root hints are functioning.<br><br>
												</li><li class="unordered">
													
														<b>/DnsDelegation</b>
													<br><br>
													Confirms that the delegated name server is functioning and checks for broken delegations.<br><br>
												</li><li class="unordered">
													
														<b>/DnsDymanicUpdate</b>
													<br><br>
													Checks that the Active Directory domain zone is configured to do secure dynamic updates and register a test record.<br><br>
												</li><li class="unordered">
													
														<b>/DnsRecordRegistration</b>
													<br><br>
													Tests the registration of all essential DC Locator records.<br><br>
												</li><li class="unordered">
													
														<b>/DnsResolveExtName</b>
													<br><br>
													Checks the basic resolution of either an intranet or Internet name.<br><br>
												</li></ul>
										</dd></dl><dl xmlns=""><dt>OutboundSecureChannels</dt><br><dd>
											Checks that secure channels exist from all of the domain controllers in the domain to the domains that are specified by the <b>/testdomain </b>parameter. The <b>/nositerestriction</b> parameter prevents dcdiag from limiting the test to the domain controllers in the site.<p>
										</dd></dl><dl xmlns=""><dt>VerifyReplicas</dt><br><dd>
											Checks that all application directory partitions are fully instantiated on all replica servers.<p>
										</dd></dl><dl xmlns=""><dt>VerifyEnterpriseReferences</dt><br><dd>
											Checks that specified system references are intact for the FRS and replication infrastructure across all objects in the enterprise on each domain controller.<p>
										</dd></dl>
									<div class="alert" xmlns=""><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
										AD DS displays text, such as naming context names and server names, which contains international or Unicode characters correctly only if you have installed appropriate fonts and language support on the test computer. <p>
									</td></tr></table><p></div>
								</content></div>
							<h4 class="subHeading" xmlns="">Non-domain controller tests</h4><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<dl xmlns=""><dt>DcPromo</dt><br><dd>
											Tests the existing DNS infrastructure for any computer that you want to promote to be a domain controller. If the infrastructure is sufficient, you can promote the computer to a domain controller in the domain specified in the parameter <b>/DnsDomain:</b><i>Active_Directory_Domain_DNS_Name</i>. This parameter reports whether any modifications to the existing DNS infrastructure are required. The required argument is <b>/DnsDomain:</b><i>Active_Directory_Domain_DNS_Name</i>.<p>
											One of the following arguments is required: <p>
											
												<b>/NewForest</b>
											<p>
											
												<b>/NewTree</b>
											<p>
											
												<b>/ChildDomain</b>
											<p>
											
												<b>/ReplicaDC</b>
											<p>
											If you specify the /<b>NewTree</b> argument, you must also specify the <b>/ForestRoot:</b><i>Forest_Root_Domain_DNS_Name</i> argument.<p>
										</dd></dl><dl xmlns=""><dt>RegisterInDNS</dt><br><dd>
											Tests whether this domain controller can register the Domain Controller Locator DNS records. These records must be present in DNS for other computers to locate this domain controller for the <i>Active_Directory_Domain_DNS_Name</i> domain. This parameter reports whether any modifications to the existing DNS infrastructure are required. The required argument is <b>/DnsDomain:</b><i>Active_Directory_Domain_DNS_Name</i><p>
										</dd></dl>
									<div class="alert" xmlns=""><table width="100%" cellspacing="0" cellpadding="0"><tr><th align="left"><img class="note" src="../local/note.gif">Note </th></tr><tr><td>
										 With the exception of the DcPromo and RegisterInDNS tests, you must promote computers to be domain controllers before you run tests on them.<p>
									</td></tr></table><p></div>
								</content></div>
						</sections></div>
				</sections></div><h2 class="heading">How to read the output of DNS-enhanced dcdiag</h2><div id="sectionSection5" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">The following steps summarize how to interpret the results provided by DNS-enhanced <code>dcdiag</code>:</p>
					<ol class="ordered" xmlns=""><li>
							Run <code>dcdiag test:DNS /e /f:dns.txt</code>. Microsoft recommends always using the <code>/v</code> switch to obtain verbose information. <br><br>
						</li><li>
							Open the report in Notepad or a compatible editor.<br><br>
						</li><li>
							Scroll to end of the report and read the summary table.<br><br>
						</li><li>
							Identify servers that returned "warn" or "fail" status for any subtest in the summary table.<br><br>
						</li><li>
							Review the section of output for that server to see what problem was detected (hint: use the <b>Find</b> command on the <b>Edit</b> menu to search on the string "<code>DC: </code><i>DC_computername</i>" (without quotes) to locate the detailed section for a given DC.<br><br>
						</li><li>
							Resolve problems on DNS clients or DNS server(s) as required. <br><br>
						</li><li>
							Run <code>dcdiag /test:DNS /v /e</code> (or <code>/s:</code><i>DCName</i>) again to verify the fix. Repeat steps 1 through 6 as required until all failures are understood and reconciled. <br><br>
						</li></ol>
				</content></div><h2 class="heading">Warnings and Errors</h2><div id="sectionSection6" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">
						<code>Dcdiag</code> takes a conservative approach by identifying DNS client or DNS server configurations that may be problematic, do not conform to best practice configurations, or that <code>dcdiag</code> cannot fully validate. Therefore, the summary and detailed sections of <code>dcdiag</code> may report warnings for DNS configurations that are currently functional. Administrators should investigate and validate such configurations when identified by <code>dcdiag</code>. </p>
					<p xmlns="">The tables below contain the configurations that can trigger <code>dcdiag</code> to report warnings or errors for each of the DNS subtests.</p>
				</content></div><h2 class="heading">Basic</h2><div id="sectionSection7" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Warning
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Warning: Adapter &lt;adapter name&gt; has dynamic IP address</p>
							</td>
							<td colspan="1">
								<p>Static IP addresses are recommended for all DNS servers. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: Adapter &lt;adapter name&gt; has invalid DNS server: &lt;name&gt; &lt;IP address&gt;</p>
							</td>
							<td colspan="1">
								<p>DNS server may not be reachable.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: No DNS RPC connectivity (error or non Microsoft DNS server is running)</p>
							</td>
							<td colspan="1">
								<p>Disregard this warning if the DNS server is a BIND or other non-Microsoft DNS server.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: The Active Directory zone on this DC/DNS server was not found</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: Root zone on this DC/DNS server was found </p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr></table>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Error
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Error: Authentication failed with specified credentials</p>
							</td>
							<td colspan="1">
								<p>DCDIAG requires Enterprise Admin credentials to run all the tests. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: No LDAP connectivity</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: No DS RPC connectivity</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: No WMI connectivity</p>
							</td>
							<td colspan="1">
								<p>DNS test requires WMI connectivity to run on the remote computer.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Can't read operating system version through WMI</p>
							</td>
							<td colspan="1">
								<p>This might be caused by the lack of a WMI connection on the remote computer.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: &lt;Operating system name&gt; not supported (this tool is supported on Windows 2000, Windows XP, and Windows Server 2003 only)</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Open Service Control Manager failed</p>
							</td>
							<td colspan="1">
								<p>Unable to find whether the service is running or not.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Kdc/netlogon/DNS/dnscache is not running</p>
							</td>
							<td colspan="1">
								<p>Some of the key services are not running.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Can't read network adapter information through WMI</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: All DNS servers are invalid</p>
							</td>
							<td colspan="1">
								<p>DNS servers that the client is pointing to are either not reachable or not a DNS server, or they have invalid IP addresses.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: The A record for this DC was not found</p>
							</td>
							<td colspan="1">
								<p>Every domain controller should register a host (A) resource record. Make sure that host (A) records are registered on all the DNS servers that the client is pointing to. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Enumeration of zones failed to find root and AD zone</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Could not query DNS zones on this DC</p>
							</td>
							<td colspan="1">
								<p>Make sure that the zone in which the domain controller is supposed to register is present.</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">Forwarder</h2><div id="sectionSection8" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Error
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Error: Forwarders list has invalid forwarder: &lt;IP address of the forwarder&gt;</p>
							</td>
							<td colspan="1">
								<p>Forwarders configured on the DNS server have an invalid IP address or are not a DNS server, or name resolution is not working (that is, cannot resolve forest root domain SRV record if it is a non-root domain domain controller). </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Both root hints and forwarders are not configured. Please configure either forwarders or root hints</p>
							</td>
							<td colspan="1">
								<p>Make sure that either forwarders or root hints are configured on the DNS server unless it hosts a root zone. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Root hints list has invalid root hint server: &lt;IP address of Root hint server&gt;</p>
							</td>
							<td colspan="1">
								<p>Root hint servers configured on the DNS server have an invalid IP address or are not a DNS server, or name resolution is not working (that is, cannot resolve forest root domain SRV record if it is a non root domain DC). </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error:&lt;Root hint server Name&gt; IP: &lt;Unavailable&gt; Status:&lt;status of the server&gt;</p>
							</td>
							<td colspan="1">
								<p>Configured root hint servers dont have corresponding IP address. Status field will tell you the status of the server</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error:&lt;Root hint server Name&gt; IP: &lt;Unavailable&gt; Status: A record not found</p>
							</td>
							<td colspan="1">
								<p>Configured root hint servers dont have A record.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Enumeration of Root hint servers failed on &lt;DNS server name&gt;</p>
							</td>
							<td colspan="1">
								<p>Couldnt list the root hint servers on the target DNS server.</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">Delegation</h2><div id="sectionSection9" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Warning
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Warning: DNS server: &lt;DnsServer name&gt;  IP: &lt;Ipaddress&gt; Failure: Missing glue A record</p>
							</td>
							<td colspan="1">
								<p>The configured delegation is missing glue A record.</p>
							</td>
						</tr></table>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Error
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>DNS server: &lt;Server name&gt; IP:&lt;IP address&gt; Error: Broken delegation -verbose</p>
							</td>
							<td colspan="1">
								<p>Delegation is configured but the name server is not responding.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>DNS server: &lt;Server name&gt; IP:&lt;IP address&gt; Error: Broken delegated domain &lt;Delegated domain name&gt; -non-verbose</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Failed to enumerate the records at the zone root on the server</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">DynamicUpdate</h2><div id="sectionSection10" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Warning
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Warning: Dynamic update is enabled on the zone but not secure &lt;zone name&gt;</p>
							</td>
							<td colspan="1">
								<p>Secure dynamic updates are recommended.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: Failed to add test record _dcdiag_test_record with error &lt;error code&gt; in zone &lt;zone name&gt;</p>
							</td>
							<td colspan="1">
								<p>Test adds a dummy record dynamically</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: Failed to delete test record _dcdiag_test_record with error &lt;error code&gt; in zone zone &lt;zone name&gt;</p>
							</td>
							<td colspan="1">
								<p>Deletes the added record as well.</p>
							</td>
						</tr></table>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Error
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Error: Dynamic update is not enabled on the zone &lt;zone name&gt;</p>
							</td>
							<td colspan="1">
								<p>Dynamic update is not enabled on the Active Directory zone so client cannot register its records.</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">Record registration</h2><div id="sectionSection11" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Warning
								</th>
								<th colspan="1">
									Additional Information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Warning: Missing DC SRV record at DNS server &lt;record name&gt;</p>
							</td>
							<td colspan="1">
								<p>Ignore the error if <code>DNSAvoidRegisterRecord </code>registry key or its Group Policy has been configured to prevent registration of this record.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: Missing GC SRV record at DNS server &lt;record name&gt;</p>
							</td>
							<td colspan="1">
								<p>Ignore the error if <code>DNSAvoidRegisterRecord </code>registry key or its Group Policy has been configured to prevent registration of this record.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: Missing PDC SRV record at DNS server &lt;record name&gt;</p>
							</td>
							<td colspan="1">
								<p>Ignore the error if <code>DNSAvoidRegisterRecord </code>registry key or its Group Policy has been configured to prevent registration of this record.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Warning: Record Registrations not found in some network adapters</p>
							</td>
							<td colspan="1">
								<p>N/A</p>
							</td>
						</tr></table>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Error
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Error: Missing A record at DNS server &lt;DNS Server IP address&gt; : &lt;A record name&gt;</p>
							</td>
							<td colspan="1">
								<p>DC hasnt registered its A record on the specified DNS server.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Missing CNAME record at DNS server &lt;DNS Server IP address&gt; : &lt;CNAME record name&gt;</p>
							</td>
							<td colspan="1">
								<p>DC hasnt registered its CNAME record on the specified DNS server.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Missing DC SRV record at DNS server &lt;DNS Server IP address&gt; : &lt;SRV record name&gt;</p>
							</td>
							<td colspan="1">
								<p>DC hasnt registered its DC SRV record on the specified DNS server.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Missing GC SRV record at DNS server &lt;DNS Server IP address&gt; : &lt;SRV record name&gt;</p>
							</td>
							<td colspan="1">
								<p>DC hasnt registered its GC SRV record on the specified DNS server.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Missing PDC SRV record at DNS server &lt;DNS Server IP address&gt; : &lt;SRV record name&gt;</p>
							</td>
							<td colspan="1">
								<p>DC hasnt registered specified PDC SRV record on the specified DNS server. All these records can be registered by stopping and starting the netlogon service. </p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Record registrations cannot be found for all the network adapters</p>
							</td>
							<td colspan="1">
								<p>If there are multiple network adapters the test checks whether all the records are present on all the DNS servers configured on each adapter. This error occurs if the record registration is missing on the DNS server. </p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">External name resolution</h2><div id="sectionSection12" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Error
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Error: Internet name &lt;name&gt; cannot be resolved</p>
							</td>
							<td colspan="1">
								<p>Specified Internet name cannot be resolved. Make sure the proxy client, servers, root hints, and forwarders are configured properly.</p>
							</td>
						</tr></table>
				</content></div><h2 class="heading">Enterprise DNS infrastructure tests</h2><div id="sectionSection13" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Warning
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Warning: Neither forwarders nor root hints are configured from subordinate domain to parent domain</p>
							</td>
							<td colspan="1">
								<p>Forwarder or root hints need to be configured in the DNS servers of either the parent or subordinate domains that are hosting the authoritative zones for their respective domain to enable name resolution to work.</p>
							</td>
						</tr></table>
					<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
								<th colspan="1">
									Error
								</th>
								<th colspan="1">
									Additional information
								</th>
							</tr><tr>
							<td colspan="1">
								<p>Error: Delegation is not configured on the parent domain</p>
							</td>
							<td colspan="1">
								<p>Delegation should be configured from parent to subordinate domain.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Delegation is present but the glue record is missing</p>
							</td>
							<td colspan="1">
								<p>Delegation is configured but the name servers are missing their glue record.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Forwarders are misconfigured from parent domain to subordinate domain</p>
							</td>
							<td colspan="1">
								<p>Forwarders must be configured from subordinate domain to parent domain.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Root hints are misconfigured from parent domain to subordinate domain</p>
							</td>
							<td colspan="1">
								<p>Root hints must be configured from subordinate domain to parent domain.</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Forwarders are configured from subordinate to parent domain but some of them failed DNS server tests (See DNS servers section for error details)</p>
							</td>
							<td colspan="1">
								<p>Forwarders configured have an invalid IP address or are not a valid DNS server, or name resolution is not working (cannot resolve forest root domain SRV record if it is in the non-root domain).</p>
							</td>
						</tr><tr>
							<td colspan="1">
								<p>Error: Root hints are configured from subordinate to parent domain but some of them failed DNS server tests (See DNS servers section for error details)</p>
							</td>
							<td colspan="1">
								<p>Root hints configured have an invalid IP address or are not a valid DNS server, or name resolution is not working.</p>
							</td>
						</tr></table>
				</content></div><a name="BKMK_examples"></a><a name="b9dbd69d-f96f-40f8-8ca5-1d96cf16f908#BKMK_examples"></a><h2 class="heading">Examples</h2><div id="sectionSection14" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">
						<b>Example 1: A normal domain controller</b>
					</p>
					<p xmlns="">In this example, you want to examine the domain controller so you can verify that it is healthy and functioning properly. Type the following command at the elevated command prompt:</p>
					<p xmlns="">
						<code>C:\Windows\system32&gt;dcdiag /s:reskit-DC1 \administrator password</code>
					</p>
					<p xmlns="">Output similar to the following appears:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>
Domain Controller Diagnosis

Performing initial setup:
   Done gathering initial info.

Doing initial required tests

   Testing server: Default-First-Site-Name\RESKIT-DC1
      Starting test: Connectivity
         ......................... RESKIT-DC1 passed test Connectivity

Doing primary tests

   Testing server: Default-First-Site-Name\RESKIT-DC1
      Starting test: Replications
         ......................... RESKIT-DC1 passed test Replications
      Starting test: NCSecDesc
         ......................... RESKIT-DC1 passed test NCSecDesc
      Starting test: NetLogons
         ......................... RESKIT-DC1 passed test NetLogons
      Starting test: Advertising
         ......................... RESKIT-DC1 passed test Advertising
      Starting test: KnowsOfRoleHolders
         ......................... RESKIT-DC1 passed test KnowsOfRoleHolders
      Starting test: RidManager
         ......................... RESKIT-DC1 passed test RidManager
      Starting test: MachineAccount
         ......................... RESKIT-DC1 passed test MachineAccount
      Starting test: Services
         ......................... RESKIT-DC1 passed test Services
      Starting test: ObjectsReplicated
         ......................... RESKIT-DC1 passed test ObjectsReplicated
      Starting test: frssysvol
         ......................... RESKIT-DC1 passed test frssysvol
      Starting test: kccevent
         ......................... RESKIT-DC1 passed test kccevent
      Starting test: systemlog

         ......................... RESKIT-DC1 passed test systemlog

   Running partition tests on : Schema
      Starting test: DeadCRTest
         ......................... Schema passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... Schema passed test CheckSDRefDom

   Running partition tests on : Configuration
      Starting test: DeadCRTest
         ......................... Configuration passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... Configuration passed test CheckSDRefDom

   Running partition tests on : RESKIT-DOM
      Starting test: DeadCRTest
         ......................... RESKIT-DOM passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... RESKIT-DOM passed test CheckSDRefDom

   Running enterprise tests on : RESKIT-DOM.reskit.com
      Starting test: Intersite
         ......................... RESKIT-DOM.reskit.com passed test Intersite
      Starting test: FsmoCheck
         ......................... RESKIT-DOM.reskit.com passed test FsmoCheck
</pre></td></tr></table></span></div>
					<p xmlns="">
						<b>Example 2: Failed DNS registration</b>
					</p>
					<p xmlns="">In this example, you have noticed that one of the domain controllers is not replicating properly. After you verify that the domain controller is operational and can be pinged by IP address, use <b>dcdiag</b> to do an enterprise check. Type the following command at an elevated command prompt:</p>
					<p xmlns="">
						<code>C:\Windows\system32&gt;dcdiag /s:reskit-DC1 \administrator password /e</code>
					</p>
					<p xmlns="">Output similar to the following appears:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>
Domain Controller Diagnosis

Performing initial setup:
   Done gathering initial info.

Doing initial required tests

   Testing server: Default-First-Site-Name\RESKIT-DC1
      Starting test: Connectivity
         ......................... RESKIT-DC1 passed test Connectivity

   Testing server: Default-First-Site-Name\RESKIT-DC2
      Starting test: Connectivity
         The host 7594898c-8ba4-4496-a01a-b0f2cadd28a6._msdcs.RESKIT-DOM.reskit.com could not be resolved to an
         IP address.  Check the DNS server, DHCP, server name, etc
         Although the Guid DNS name
         (7594898c-8ba4-4496-a01a-b0f2cadd28a6._msdcs.RESKIT-DOM.reskit.com)
          couldn't be resolved, the server name
         (reskit-DC2.reskit-sib.RESKIT-DOM.reskit.com) resolved
         to the IP address (172.26.220.34) and was pingable.  Check that the IP
         address is registered correctly with the DNS server.
         ......................... RESKIT-DC2 failed test Connectivity

Doing primary tests

   Testing server: Default-First-Site-Name\RESKIT-DC1
      Starting test: Replications
         [Replications Check,RESKIT-DC1] A recent replication attempt failed:
            From RESKIT-DC2 to RESKIT-DC1
            Naming Context: CN=Configuration,DC=RESKIT-DOM,DC=reskit,DC=com
            The replication generated an error (1722):
            The RPC server is unavailable.
            The failure occurred at 2007-12-21 02:19:04.
            The last success occurred at 2007-12-21 01:57:43.
            1 failures have occurred since the last success.
            The source remains down. Please check the machine.
         ......................... RESKIT-DC1 passed test Replications
      Starting test: NCSecDesc
         ......................... RESKIT-DC1 passed test NCSecDesc
      Starting test: NetLogons
         ......................... RESKIT-DC1 passed test NetLogons
      Starting test: Advertising
         ......................... RESKIT-DC1 passed test Advertising
      Starting test: KnowsOfRoleHolders
         ......................... RESKIT-DC1 passed test KnowsOfRoleHolders
      Starting test: RidManager
         ......................... RESKIT-DC1 passed test RidManager
      Starting test: MachineAccount
         ......................... RESKIT-DC1 passed test MachineAccount
      Starting test: Services
         ......................... RESKIT-DC1 passed test Services
      Starting test: ObjectsReplicated
         ......................... RESKIT-DC1 passed test ObjectsReplicated
      Starting test: frssysvol
         ......................... RESKIT-DC1 passed test frssysvol
      Starting test: kccevent
         ......................... RESKIT-DC1 passed test kccevent
      Starting test: systemlog
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:28:25
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:40:30
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:43:30
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:58:46
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:02:11
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:05:11
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:10:51
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:13:51
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:18:58
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:21:58
            Event String: The time provider NtpClient is configured to
         ......................... RESKIT-DC1 failed test systemlog

   Testing server: Default-First-Site-Name\RESKIT-DC2
      Skipping all tests, because server RESKIT-DC2 is
      not responding to directory service requests

   Running partition tests on : Schema
      Starting test: DeadCRTest
         ......................... Schema passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... Schema passed test CheckSDRefDom

   Running partition tests on : Configuration
      Starting test: DeadCRTest
         ......................... Configuration passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... Configuration passed test CheckSDRefDom

   Running partition tests on : RESKIT-DOM
      Starting test: DeadCRTest
         ......................... RESKIT-DOM passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... RESKIT-DOM passed test CheckSDRefDom

   Running partition tests on : reskit-sib
      Starting test: DeadCRTest
         ......................... reskit-sib passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... reskit-sib passed test CheckSDRefDom

   Running enterprise tests on : RESKIT-DOM.reskit.com
      Starting test: Intersite
         ......................... RESKIT-DOM.reskit.com passed test Intersite
      Starting test: FsmoCheck
         ......................... RESKIT-DOM.reskit.com passed test FsmoCheck
</pre></td></tr></table></span></div>
					<p xmlns="">
						<b>Example 3: Failed Netlogon Service</b>
					</p>
					<p xmlns="">In this example, the Netlogon Service has failed on one of the domain controllers. To troubleshoot, type the following command at an elevated command prompt:</p>
					<p xmlns="">
						<code>C:\Windows\system32&gt;dcdiag /s:reskit-DC1 \administrator password</code>
					</p>
					<p xmlns="">Output similar to the following appears:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>
Domain Controller Diagnosis

Performing initial setup:
   Done gathering initial info.

Doing initial required tests

   Testing server: Default-First-Site-Name\RESKIT-DC1
      Starting test: Connectivity
         ......................... RESKIT-DC1 passed test Connectivity

Doing primary tests

   Testing server: Default-First-Site-Name\RESKIT-DC1
      Starting test: Replications
         ......................... RESKIT-DC1 passed test Replications
      Starting test: NCSecDesc
         ......................... RESKIT-DC1 passed test NCSecDesc
      Starting test: NetLogons
         ......................... RESKIT-DC1 passed test NetLogons
      Starting test: Advertising
         Fatal Error:DsGetDcName (RESKIT-DC1) call failed, error 1722
         The Locator could not find the server.
         ......................... RESKIT-DC1 failed test Advertising
      Starting test: KnowsOfRoleHolders
         ......................... RESKIT-DC1 passed test KnowsOfRoleHolders
      Starting test: RidManager
         ......................... RESKIT-DC1 passed test RidManager
      Starting test: MachineAccount
         ......................... RESKIT-DC1 passed test MachineAccount
      Starting test: Services
            NETLOGON Service is stopped on [RESKIT-DC1]
         ......................... RESKIT-DC1 failed test Services
      Starting test: ObjectsReplicated
         ......................... RESKIT-DC1 passed test ObjectsReplicated
      Starting test: frssysvol
         ......................... RESKIT-DC1 passed test frssysvol
      Starting test: kccevent
         ......................... RESKIT-DC1 passed test kccevent
      Starting test: systemlog
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:28:25
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:40:30
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:43:30
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:58:46
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:02:11
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:05:11
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:10:51
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:13:51
            Event String: The time provider NtpClient is configured to
         ......................... RESKIT-DC1 failed test systemlog

   Running partition tests on : Schema
      Starting test: DeadCRTest
         ......................... Schema passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... Schema passed test CheckSDRefDom

   Running partition tests on : Configuration
      Starting test: DeadCRTest
         ......................... Configuration passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... Configuration passed test CheckSDRefDom

   Running partition tests on : RESKIT-DOM
      Starting test: DeadCRTest
         ......................... RESKIT-DOM passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... RESKIT-DOM passed test CheckSDRefDom

   Running enterprise tests on : RESKIT-DOM.reskit.com
      Starting test: Intersite
         ......................... RESKIT-DOM.reskit.com passed test Intersite
      Starting test: FsmoCheck
         Warning: DcGetDcName(GC_SERVER_REQUIRED) call failed, error 1717
         A Global Catalog Server could not be located - All GC's are down.
         Warning: DcGetDcName(PDC_REQUIRED) call failed, error 1717
         A Primary Domain Controller could not be located.
         The server holding the PDC role is down.
         Warning: DcGetDcName(TIME_SERVER) call failed, error 1717
         A Time Server could not be located.
         The server holding the PDC role is down.
         Warning: DcGetDcName(GOOD_TIME_SERVER_PREFERRED) call failed, error 1717
         A Good Time Server could not be located.
         Warning: DcGetDcName(KDC_REQUIRED) call failed, error 1717
         A KDC could not be located - All the KDCs are down.
         ......................... RESKIT-DOM.reskit.com failed test FsmoCheck
</pre></td></tr></table></span></div>
					<p xmlns="">
						<b>Example 4: Unresponsive or inaccessible server</b>
					</p>
					<p xmlns="">In this example, you have noticed replication problems. To resolve the issue, type the following command at an elevated command prompt:</p>
					<p xmlns="">
						<code>C:\Windows\system32&gt;dcdiag /s:reskit-DC1 \administrator password /e</code>
					</p>
					<p xmlns="">Output similar to the following appears:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>
Domain Controller Diagnosis

Performing initial setup:
   Done gathering initial info.

Doing initial required tests

   Testing server: Default-First-Site-Name\RESKIT-DC1
      Starting test: Connectivity
         ......................... RESKIT-DC1 passed test Connectivity

   Testing server: Default-First-Site-Name\RESKIT-DC2
      Starting test: Connectivity
         Server RESKIT-DC2 resolved to this IP address 172.26.220.34,
         but the address couldn't be reached(pinged), so check the network.
         The error returned was: Error due to lack of resources.
         This error more often means that the targeted server is
         shutdown or disconnected from the network
         ......................... RESKIT-DC2 failed test Connectivity

Doing primary tests

   Testing server: Default-First-Site-Name\RESKIT-DC1
      Starting test: Replications
         [Replications Check,RESKIT-DC1] A recent replication attempt failed:
            From RESKIT-DC2 to RESKIT-DC1
            Naming Context: CN=Configuration,DC=RESKIT-DOM,DC=reskit,DC=com
            The replication generated an error (1722):
            The RPC server is unavailable.
            The failure occurred at 2007-12-21 02:19:04.
            The last success occurred at 2007-12-21 01:57:43.
            1 failures have occurred since the last success.
            The source remains down. Please check the machine.
         ......................... RESKIT-DC1 passed test Replications
      Starting test: NCSecDesc
         ......................... RESKIT-DC1 passed test NCSecDesc
      Starting test: NetLogons
         ......................... RESKIT-DC1 passed test NetLogons
      Starting test: Advertising
         ......................... RESKIT-DC1 passed test Advertising
      Starting test: KnowsOfRoleHolders
         ......................... RESKIT-DC1 passed test KnowsOfRoleHolders
      Starting test: RidManager
         ......................... RESKIT-DC1 passed test RidManager
      Starting test: MachineAccount
         ......................... RESKIT-DC1 passed test MachineAccount
      Starting test: Services
         ......................... RESKIT-DC1 passed test Services
      Starting test: ObjectsReplicated
         ......................... RESKIT-DC1 passed test ObjectsReplicated
      Starting test: frssysvol
         ......................... RESKIT-DC1 passed test frssysvol
      Starting test: kccevent
         ......................... RESKIT-DC1 passed test kccevent
      Starting test: systemlog
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:28:25
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:40:30
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:43:30
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   01:58:46
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:02:11
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:05:11
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:10:51
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:13:51
            Event String: The time provider NtpClient is configured to
         An Error Event occurred.  EventID: 0xC25A001D
            Time Generated: 12/21/2007   02:18:58
            Event String: The time provider NtpClient is configured to
         ......................... RESKIT-DC1 failed test systemlog

   Testing server: Default-First-Site-Name\RESKIT-DC2
      Skipping all tests, because server RESKIT-DC2 is
      not responding to directory service requests

   Running partition tests on : Schema
      Starting test: DeadCRTest
         ......................... Schema passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... Schema passed test CheckSDRefDom

   Running partition tests on : Configuration
      Starting test: DeadCRTest
         ......................... Configuration passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... Configuration passed test CheckSDRefDom

   Running partition tests on : RESKIT-DOM
      Starting test: DeadCRTest
         ......................... RESKIT-DOM passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... RESKIT-DOM passed test CheckSDRefDom

   Running partition tests on : reskit-sib
      Starting test: DeadCRTest
         ......................... reskit-sib passed test DeadCRTest
      Starting test: CheckSDRefDom
         ......................... reskit-sib passed test CheckSDRefDom

   Running enterprise tests on : RESKIT-DOM.reskit.com
      Starting test: Intersite
         ......................... RESKIT-DOM.reskit.com passed test Intersite
      Starting test: FsmoCheck
         ......................... RESKIT-DOM.reskit.com passed test FsmoCheck
</pre></td></tr></table></span></div>
				</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
						</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
							<h4 class="subHeading" xmlns="">Additional references</h4><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
									<p xmlns="">
										<a href="338c0381-ad63-4a4c-bd2c-42c7a93821fe.htm">Command-Line Syntax Key</a>
									</p>
								</content></div>
						</sections></div>
				</sections></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><hr><p></div></div></body></html>