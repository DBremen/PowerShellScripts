<html dir="LTR" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:tool="http://www.microsoft.com/tooltip"><head><meta http-equiv="Content-Type" content="text/html; CHARSET=Windows-1252"><meta name="save" content="history"><title>Netdiag</title><link rel="stylesheet" type="text/css" href="../local/Classic.css"><script src="../local/script.js"></script></head><body><div><input type="hidden" id="userDataCache" class="userDataStyle"><input type="hidden" id="hiddenScrollOffset"></div><img id="dropDownImage" style="display:none; height:0; width:0;" src="../local/drpdown.gif"><img id="dropDownHoverImage" style="display:none; height:0; width:0;" src="../local/drpdown_orange.gif"><img id="collapseImage" style="display:none; height:0; width:0;" src="../local/collapse.gif"><img id="expandImage" style="display:none; height:0; width:0;" src="../local/exp.gif"><img id="copyImage" style="display:none; height:0; width:0;" src="../local/copycode.gif"><img id="copyHoverImage" style="display:none; height:0; width:0;" src="../local/copycodeHighlight.gif"><div id="header"><table width="100%" id="topTable"><tr id="headerTableRow1"><td align="left"><span id="runningHeaderText"></span></td></tr><tr id="headerTableRow2"><td align="left"><span id="nsrTitle">Netdiag</span></td></tr><tr id="headerTableRow3"><td></td></tr></table></div><div id="mainSection"><div id="mainBody"><div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()"></div><p>Applies To: Windows Server 2003</p>
				<p>The Netdiag command-line diagnostic tool helps to isolate networking and connectivity problems by performing a series of tests to determine the state of your network client. These tests and the key network status information that they expose give network administrators and support personnel a more direct means of identifying and isolating network problems. Moreover, because this tool does not require parameters or switches to be specified, support personnel and network administrators can focus on analyzing the output rather than on training users how to use the tool. For examples of how this command can be used, see <b>Examples</b>.</p>
			<h2 class="heading">Syntax</h2><div id="sectionSection0" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>netdiag [/q] [/v] [/l] [/debug] [/d:DomainName] [/fix] [/DcAccountEnum] [/test:TestName] [/skip:TestName] [/?]</pre></td></tr></table></span></div>
				</content><sections xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<h3 class="subHeading" xmlns="">Parameters</h3><div class="subSection" xmlns=""><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
							<h3 class="subHeading" xmlns=""></h3><table xmlns=""><tr>
										<th>
											Parameter
										</th>
										<th>
											Description
										</th>
									</tr><tr>
									<td>
										<p>/q</p>
									</td>
									<td>
										<p>Specifies quiet output (errors only).</p>
									</td>
								</tr><tr>
									<td>
										<p>/v</p>
									</td>
									<td>
										<p>Specifies verbose output.</p>
									</td>
								</tr><tr>
									<td>
										<p>/l</p>
									</td>
									<td>
										<p>Sends output to Netdiag.log. This log file is created in the same directory where Netdiag.exe was run.</p>
									</td>
								</tr><tr>
									<td>
										<p>/debug</p>
									</td>
									<td>
										<p>Specifies even more verbose output. With this parameter, NetDiag takes a few minutes to complete.</p>
									</td>
								</tr><tr>
									<td>
										<p>/d: DomainName</p>
									</td>
									<td>
										<p>Finds a domain controller in the specified domain.</p>
									</td>
								</tr><tr>
									<td>
										<p>/fix</p>
									</td>
									<td>
										<p>Fixes minor problems.</p>
									</td>
								</tr><tr>
									<td>
										<p>/DcAccountEnum</p>
									</td>
									<td>
										<p>Enumerates domain controller computer accounts.</p>
									</td>
								</tr><tr>
									<td>
										<p>/test: TestName</p>
									</td>
									<td>
										<p>Runs only the listed test(s). TCP/IP must be bound to one or more adapters before running any of the tests. Nonskippable tests are still run.</p>
										<p>Valid TestName values are:</p>
										<ul><li class="unordered">
												Autonet - Automatic Private IP Addressing (APIPA) address test. Tests whether APIPA is in use for the network adapters.<br><br>
											</li><li class="unordered">
												Bindings - Bindings test. Lists all bindings, including interface name, lower module name, upper module name, whether the binding is currently enabled, and the owner of the binding.<br><br>
											</li><li class="unordered">
												Browser - Redirector and Browser test. Lists the protocols bound to the Browser service and the redirector.<br><br>
											</li><li class="unordered">
												DcList - Domain controller list test. Obtains a list of domain controllers for the domain.<br><br>
											</li><li class="unordered">
												DefGw - Default gateway test. Attempts to contact each configured default gateway.<br><br>
											</li><li class="unordered">
												DNS - DNS test. Tests the availability of the configured DNS servers and verifies the current client's DNS registrations.<br><br>
											</li><li class="unordered">
												DsGetDc - Domain controller discovery test. First finds a generic domain controller from directory service, then finds the primary domain controller. Then, finds a Windows 2000 domain controller (DC). If the tested domain is the primary domain, checks whether the domain GUID stored in Local Security Authority (LSA) is the same as the domain GUID stored in the DC. If not, the test returns a fatal error; if the /fix option is on, DsGetDC tries to fix the GUID in LSA.<br><br>
											</li><li class="unordered">
												IpConfig - IP address configuration test. Enumerates the TCP/IP configuration information for each network adapter.<br><br>
											</li><li class="unordered">
												IpLoopBk - IP address loopback ping test. Pings the IP loopback address of 127.0.0.1 for each adapter.<br><br>
											</li><li class="unordered">
												IPsec – Internet Protocol Security (IPsec) test. Tests whether IPsec is enabled and displays a list of active IPsec policies for the computer.<br><br>
											</li><li class="unordered">
												IPX - IPX test. Lists statistics for the IPX protocol installed on the computer.<br><br>
											</li><li class="unordered">
												Kerberos - Kerberos test. Checks whether the Kerberos package information is up-to-date.<br><br>
											</li><li class="unordered">
												Ldap - Lightweight Directory Access Protocol (LDAP) test. Contacts all available domain controllers and determines which LDAP authentication protocol is in use.<br><br>
											</li><li class="unordered">
												Member - Domain membership test. Checks to confirm details of the primary domain, including computer role, domain name, and domain GUID. Checks to see if NetLogon service is started, adds the primary domain to the domain list, and queries the primary domain security identifier (SID).<br><br>
											</li><li class="unordered">
												Modem - Modem diagnostics test. Lists configuration information for each modem found.<br><br>
											</li><li class="unordered">
												NbtNm - NetBT name test. Similar to the nbtstat -n command. It checks that the workstation service name &lt;00&gt; is equal to the computer name. It also checks that the messenger service name &lt;03&gt;, and server service name &lt;20&gt; are present on all interfaces and that none of these names are in conflict.<br><br>
											</li><li class="unordered">
												Ndis - Netcard queries test. Lists the network adapter configuration details, including the adapter name, configuration, media, globally unique identifier (GUID), and statistics. If this test shows an unresponsive network adapter, the remaining tests are aborted.<br><br>
											</li><li class="unordered">
												NetBTTransports - NetBT transports test. Lists the transport protocols that are bound to NetBT.<br><br>
											</li><li class="unordered">
												Netstat - Netstat information test. Lists protocol statistics and current TCP/IP connections. <br><br>
											</li><li class="unordered">
												Netware - Netware test. Queries the nearest Netware server for current login information.<br><br>
											</li><li class="unordered">
												Route - Routing table test. Lists static routes and whether they are persistent.<br><br>
											</li><li class="unordered">
												Trust - Trust relationship test. Tests trust relationships to the primary domain only if the computer is a member workstation, member server, or a Backup Domain Controller (BDC) domain controller that is not a PDC emulator. Checks that the primary domain security identifier (SID) is correct. Contacts an active DC. Connects to the SAM server on the DC. Uses the domain SID to open the domain to verify whether the domain SID is correct. Queries info of the secure channel for the primary domain. If the computer is a BDCDC, reconnects to the PDC emulator. If the computer is a member workstation or server, sets secure channel to each DC on the DC list for this domain.<br><br>
											</li><li class="unordered">
												WAN - Wide Area Network (WAN) configuration test. Lists settings and status on each COM port currently in use.<br><br>
											</li><li class="unordered">
												WINS - Windows Internet Name Service (WINS) service test. Tests the availability of the configured WINS server and the validity of the client registrations.<br><br>
											</li><li class="unordered">
												Winsock - Winsock test. Lists protocols and ports available to the WinSock service.<br><br>
											</li></ul>
									</td>
								</tr><tr>
									<td>
										<p>/skip: TestName</p>
									</td>
									<td>
										<p>Skips the test specified by TestName. Nonskippable tests will still run.</p>
										<p>Valid TestName values are:</p>
										<ul><li class="unordered">
												Autonet - Automatic Private IP Addressing (APIPA) address test.<br><br>
											</li><li class="unordered">
												Bindings - Bindings test.<br><br>
											</li><li class="unordered">
												Browser - Redir and Browser test.<br><br>
											</li><li class="unordered">
												DcList - Domain controller list test.<br><br>
											</li><li class="unordered">
												DefGw - Default gateway test.<br><br>
											</li><li class="unordered">
												DNS - DNS test.<br><br>
											</li><li class="unordered">
												DsGetDc - Domain controller discovery test.<br><br>
											</li><li class="unordered">
												IpConfig - IP address configuration test.<br><br>
											</li><li class="unordered">
												IpLoopBk - IP address loopback ping test.<br><br>
											</li><li class="unordered">
												IPX - IPX test.<br><br>
											</li><li class="unordered">
												Kerberos - Kerberos test.<br><br>
											</li><li class="unordered">
												Ldap - Lightweight Directory Access Protocol (LDAP) test.<br><br>
											</li><li class="unordered">
												Modem - Modem diagnostics test.<br><br>
											</li><li class="unordered">
												NbtNm - NetBT name test.<br><br>
											</li><li class="unordered">
												Netstat - Netstat information test.<br><br>
											</li><li class="unordered">
												Netware - Netware test.<br><br>
											</li><li class="unordered">
												Route - Routing table test.<br><br>
											</li><li class="unordered">
												Trust - Trust relationship test.<br><br>
											</li><li class="unordered">
												WAN - Wide Area Network (WAN) configuration test.<br><br>
											</li><li class="unordered">
												WINS - Windows Internet Name Service (WINS) test.<br><br>
											</li><li class="unordered">
												Winsock - Winsock test.<br><br>
											</li></ul>
									</td>
								</tr></table>
						</content></div>
				</sections></div><h2 class="heading">Remarks</h2><div id="sectionSection1" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">The NetDiag tool:</p>
					<ul xmlns=""><li class="unordered">
							Gathers static network information and tests the network driver, protocol driver, send/receive capability, and well-known target accessibility.<br><br>
						</li><li class="unordered">
							Can be used by network administrators in conjunction with the Scheduler Service, to generate reports at regularly scheduled intervals.<br><br>
						</li></ul>
				</content></div><a name="BKMK_Examples"></a><a name="9fe8f3da-70dd-46ae-93ca-34d73d122db3#BKMK_Examples"></a><h2 class="heading">Examples</h2><div id="sectionSection2" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<p xmlns="">If you have a problem connecting to a network resource and you only receive a “Network path not found” error message you can type the following at a command prompt:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>netdiag</pre></td></tr></table></span></div>
					<p xmlns="">When executed in this scenario, NetDiag performs tests on each network adapter, and a set of global tests. The tests on the network adapters are performed in the following order:</p>
					<ul xmlns=""><li class="unordered">
							Netcard queries test<br><br>
						</li><li class="unordered">
							IpConfig test<br><br>
						</li><li class="unordered">
							Autoconfiguration test (APIPA)<br><br>
						</li><li class="unordered">
							Default gateway test<br><br>
						</li><li class="unordered">
							NetBT name test<br><br>
						</li><li class="unordered">
							WINS Service test<br><br>
						</li></ul>
					<p xmlns="">Next in this example NetDiag performs a set of global tests in the following order:</p>
					<ul xmlns=""><li class="unordered">
							Domain membership test<br><br>
						</li><li class="unordered">
							NetBT transports test<br><br>
						</li><li class="unordered">
							Autonet address test (APIPA)<br><br>
						</li><li class="unordered">
							IP loopback ping test<br><br>
						</li><li class="unordered">
							Default gateway test<br><br>
						</li><li class="unordered">
							NetBT name test<br><br>
						</li><li class="unordered">
							Winsock test<br><br>
						</li><li class="unordered">
							DNS test<br><br>
						</li><li class="unordered">
							Redir and Browser test<br><br>
						</li><li class="unordered">
							DC discovery test<br><br>
						</li><li class="unordered">
							DC list test<br><br>
						</li><li class="unordered">
							Trust relationship test<br><br>
						</li><li class="unordered">
							Kerberos test<br><br>
						</li><li class="unordered">
							LDAP test<br><br>
						</li><li class="unordered">
							Bindings test<br><br>
						</li><li class="unordered">
							WAN configuration test<br><br>
						</li><li class="unordered">
							Modem configuration test<br><br>
						</li><li class="unordered">
							IP Security test<br><br>
						</li></ul>
					<p xmlns="">The results of these tests show that the network adapter protocol, bindings, and IP address tests succeed. The DNS ping test fails and reports that the DNS server cannot be contacted.</p>
					<p xmlns="">With this information, the administrator knows that either the DNS server address is incorrect, or the DNS server is not responding. Because the DNS address is also displayed as output, you can easily verify whether it is correct.</p>
					<p xmlns="">After the problem is isolated, the administrator can perform additional troubleshooting to determine why the DNS server is down.</p>
					<p xmlns="">Sample NetDiag Output:</p>
					<div class="code" xmlns=""><span codelanguage="other"><table width="100%" cellspacing="0" cellpadding="0"><tr><th> </th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif">Copy Code</span></th></tr><tr><td colspan="2"><pre>Computer Name: RKSRVR-2
    DNS Host Name: rksrvr-2.reskita.microsoft.com
    System info : Windows 2000 Server (Build 2467)
    Processor : x86 Family 6 Model 6 Stepping 0, GenuineIntel
    List of installed hotfixes :
        Q147222


Netcard queries test . . . . . . . : Passed
    [WARNING] The net card 'Intel(R) PRO/100+ Management Adapter' may not be working.



Per interface results:

    Adapter : Local Area Connection

        Netcard queries test . . . : Passed

        Host Name. . . . . . . . . : rksrvr-2
        IP Address . . . . . . . . : 10.10.1.51
        Subnet Mask. . . . . . . . : 255.255.255.0
        Default Gateway. . . . . . :
        Dns Servers. . . . . . . . : 10.10.1.77


        AutoConfiguration results. . . . . . : Passed

        Default gateway test . . . : Skipped
            [WARNING] No gateways defined for this adapter.

        NetBT name test. . . . . . : Passed

        WINS service test. . . . . : Skipped
            There are no WINS servers configured for this interface.

    Adapter : Local Area Connection 2

        Netcard queries test . . . : Failed
        NetCard Status:          DISCONNECTED
            Some tests will be skipped on this interface.

        Host Name. . . . . . . . . : rksrvr-2
        Autoconfiguration IP Address : 169.254.74.217
        Subnet Mask. . . . . . . . : 255.255.0.0
        Default Gateway. . . . . . :
        Dns Servers. . . . . . . . :



Global results:


Domain membership test . . . . . . : Passed


NetBT transports test. . . . . . . : Passed
    List of NetBt transports currently configured:
        NetBT_Tcpip_{A2D04C22-3BB8-4FA0-B7DA-414DC1DD08A7}
        NetBT_Tcpip_{56079E37-8246-4712-8B36-F503FF6F9873}
    2 NetBt transports currently configured.


Autonet address test . . . . . . . : Passed


IP loopback ping test. . . . . . . : Passed


Default gateway test . . . . . . . : Failed

    [FATAL] NO GATEWAYS ARE REACHABLE.
    You have no connectivity to other network segments.
    If you configured the IP protocol manually then
    you need to add at least one valid gateway.


NetBT name test. . . . . . . . . . : Passed


Winsock test . . . . . . . . . . . : Passed


DNS test . . . . . . . . . . . . . : Failed
          [WARNING] Cannot find a primary authoritative DNS server for the name
            'bdover.reskita.microsoft.com.'. [ERROR_TIMEOUT]
            The name 'bdover.reskita.microsoft.com.' may not be registered in DNS.

       [WARNING] The DNS entries for this DC cannot be verified right now on DNS
 server 10.10.1.77, ERROR_TIMEOUT.
    [FATAL] No DNS servers have the DNS records for this DC registered.


Redir and Browser test . . . . . . : Passed
    List of NetBt transports currently bound to the Redir
        NetBT_Tcpip_{A2D04C22-3BB8-4FA0-B7DA-414DC1DD08A7}
        NetBT_Tcpip_{56079E37-8246-4712-8B36-F503FF6F9873}
    The redir is bound to 2 NetBt transports.

    List of NetBt transports currently bound to the browser
        NetBT_Tcpip_{A2D04C22-3BB8-4FA0-B7DA-414DC1DD08A7}
        NetBT_Tcpip_{56079E37-8246-4712-8B36-F503FF6F9873}
    The browser is bound to 2 NetBt transports.


DC discovery test. . . . . . . . . : Passed


DC list test . . . . . . . . . . . : Passed


Trust relationship test. . . . . . : Failed
    Secure channel for domain 'RESKITA' is to '\\a-dcp.reskita.microsoft.com'.
    [FATAL] Cannot set secure channel for domain 'RESKITA' to PDC emulator. [ERR
OR_NO_LOGON_SERVERS]


Kerberos test. . . . . . . . . . . : Passed


LDAP test. . . . . . . . . . . . . : Passed
    [WARNING] Failed to query SPN registration on DC 'a-dcp.reskita.microsoft.com'.
    [WARNING] Failed to query SPN registration on DC 'a-dc1.reskita.microsoft.com'.
    [WARNING] Failed to query SPN registration on DC 'a-dc3.reskita.microsoft.com'.


Bindings test. . . . . . . . . . . : Passed


WAN configuration test . . . . . . : Skipped
    No active remote access connections.


Modem diagnostics test . . . . . . : Passed

IP Security test . . . . . . . . . : Passed
    Service status  is: Started
    Service startup is: Automatic
    IPSec service is available, but no policy is assigned or active

    Note: run "ipseccmd /?" for more detailed information

The command completed successfully</pre></td></tr></table></span></div>
				</content></div><h2 class="heading">Additional references</h2><div id="sectionSection3" class="section"><content xmlns="http://ddue.schemas.microsoft.com/authoring/2003/5">
					<ul xmlns=""><li>
							
								<a href="338c0381-ad63-4a4c-bd2c-42c7a93821fe.htm">Command-Line Syntax Key</a>
							<br><br>
						</li></ul>
				</content></div><!--[if gte IE 5]>
			<tool:tip element="languageFilterToolTip" avoidmouse="false"/>
		<![endif]--></div><div id="footer"><hr><p></div></div></body></html>